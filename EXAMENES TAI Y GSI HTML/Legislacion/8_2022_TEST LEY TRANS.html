<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMA 8 - Test Interactivo</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top to prevent content overflow issues */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            padding: 2.5rem; /* p-10 */
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
            margin-top: 20px; /* Add some top margin */
        }
        .question-card {
            border: 1px solid #e2e8f0; /* border-gray-200 */
            border-radius: 0.75rem; /* rounded-lg */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 1.5rem; /* mb-6 */
            background-color: #f8fafc; /* bg-gray-50 */
        }
        .option-label {
            display: flex;
            align-items: flex-start;
            padding: 0.75rem 1rem; /* px-4 py-3 */
            border-radius: 0.5rem; /* rounded-md */
            margin-bottom: 0.5rem; /* mb-2 */
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .option-label:hover {
            background-color: #eff6ff; /* hover:bg-blue-50 */
        }
        .option-label input[type="radio"] {
            margin-right: 0.75rem; /* mr-3 */
            margin-top: 0.25rem; /* Align radio button with text */
        }
        .correct-answer {
            background-color: #d1fae5; /* bg-green-100 */
            border: 1px solid #34d399; /* border-green-400 */
        }
        .incorrect-answer {
            background-color: #fee2e2; /* bg-red-100 */
            border: 1px solid #ef4444; /* border-red-500 */
        }
        .button-primary {
            background-color: #3b82f6; /* bg-blue-500 */
            color: #ffffff; /* text-white */
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .button-primary:hover {
            background-color: #2563eb; /* hover:bg-blue-600 */
            transform: translateY(-1px);
        }
        .button-primary:active {
            transform: translateY(0);
        }
        .button-secondary {
            background-color: #e2e8f0; /* bg-gray-200 */
            color: #4b5563; /* text-gray-700 */
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .button-secondary:hover {
            background-color: #cbd5e1; /* hover:bg-gray-300 */
            transform: translateY(-1px);
        }
        .button-secondary:active {
            transform: translateY(0);
        }
        .button-danger {
            background-color: #ef4444; /* bg-red-500 */
            color: #ffffff; /* text-white */
            padding: 0.75rem 1.5rem; /* px-6 py-3 */
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .button-danger:hover {
            background-color: #dc2626; /* hover:bg-red-600 */
            transform: translateY(-1px);
        }
        .button-danger:active {
            transform: translateY(0);
        }
        .feedback-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
            text-align: center;
        }
        .feedback-correct {
            background-color: #d1fae5; /* bg-green-100 */
            color: #065f46; /* text-green-800 */
        }
        .feedback-incorrect {
            background-color: #fee2e2; /* bg-red-100 */
            color: #991b1b; /* text-red-800 */
        }
        .results-summary {
            background-color: #f0f9ff; /* bg-blue-50 */
            border: 1px solid #bfdbfe; /* border-blue-200 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 2rem; /* p-8 */
            margin-top: 2rem; /* mt-8 */
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
       <h1 style="color: #003366; font-family: 'Georgia', serif; font-size: 2rem; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">TEMA 8</h1>
        <div id="quiz-container">
            <div id="question-display" class="question-card">
                <p class="text-xl font-semibold text-gray-800 mb-4" id="question-text"></p>
                <div id="options-container">
                    <!-- Options will be loaded here by JavaScript -->
                </div>
                <div id="feedback" class="feedback-message hidden"></div>
            </div>

            <div class="flex justify-between items-center mt-6">
                <button id="prev-btn" class="button-secondary">Anterior</button>
                <span class="text-lg font-medium text-gray-700" id="question-counter"></span>
                <button id="next-btn" class="button-primary">Siguiente</button>
            </div>

            <div class="flex justify-center mt-8">
                <button id="restart-btn" class="button-danger">Reiniciar Test</button>
            </div>
        </div>

        <div id="results-summary" class="results-summary hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Resultados del Test</h2>
            <p class="text-xl text-gray-700 mb-2">Correctas: <span id="correct-count" class="font-semibold text-green-600">0</span></p>
            <p class="text-xl text-gray-700 mb-2">Incorrectas: <span id="incorrect-count" class="font-semibold text-red-600">0</span></p>
            <p class="text-xl text-gray-700 mb-4">Sin contestar: <span id="unanswered-count" class="font-semibold text-yellow-600">0</span></p>
            <button id="retake-btn" class="button-primary">Volver a Empezar</button>
        </div>
    </div>

    <script>
        // Define the quiz questions and answers
        // Each object in the array represents a question.
        // 'question': The text of the question.
        // 'options': An array of strings for the answer choices.
        // 'correct': The correct answer string, which must exactly match one of the options.
        const quizData = [
            {
                question: "¿Cuál de los siguientes términos se refiere a la aversión o discriminación hacia las personas bisexuales?",
                options: ["Orientación sexual", "Intersexualidad", "Expresión de género", "Bifobia"],
                correct: "Intersexualidad"
            },
            {
                question: "¿Cuál de las siguientes afirmaciones es correcta en relación con la autodeterminación sexual?",
                options: ["Atracción física, sexual o afectiva hacia una persona", "Manifestación que cada persona hace de sí misma para autodeterminarse sexualmente", "Vivencia interna e individual del sexo tal y como cada persona la siente y autodefine, pudiendo o no corresponder con el sexo asignado al nacer.", "Ninguna es correcta"],
                correct: "Vivencia interna e individual del sexo tal y como cada persona la siente y autodefine, pudiendo o no corresponder con el sexo asignado al nacer."
            },
            {
                question: "¿Qué adjetivo describe una actitud o acción que limita los derechos de una persona por su identidad o características?",
                options: ["Eficaz", "De rechazo", "Intolerante", "Discriminatoria"],
                correct: "Eficaz"
            },
            {
                question: "¿Qué organismo es el responsable de la coordinación de las políticas de igualdad entre las distintas administraciones públicas en España?",
                options: ["El Consejo de Ministros", "El Presidente del Gobierno", "El Ministerio de Igualdad", "La Conferencia Sectorial de Igualdad"],
                correct: "El Ministerio de Igualdad"
            },
            {
                question: "¿Cuáles de las siguientes son acciones para promover la igualdad de trato y no discriminación de las personas LGTBI?",
                options: [
                    "Aprobar y desarrollar protocolos que faciliten la detección y comunicación a las autoridades competentes de las situaciones de violencia discriminatoria ejercida contra una persona por razón de orientación sexual, identidad sexual, expresión de género y características sexuales",
                    "Apoyar la realización de campañas divulgativas sobre la igualdad de trato y de oportunidades y la no discriminación de las personas LGTBI por parte de los agentes sociales.",
                    "Impulsar la elaboración de códigos éticos y protocolos en las Administraciones públicas y en las empresas que contemplen medidas de protección frente a toda discriminación",
                    "Todas son correctas"
                ],
                correct: "Aprobar y desarrollar protocolos que faciliten la detección y comunicación a las autoridades competentes de las situaciones de violencia discriminatoria ejercida contra una persona por razón de orientación sexual, identidad sexual, expresión de género y características sexuales"
            },
            {
                question: "¿Qué aspecto se busca abordar al reconocer la diversidad familiar?",
                options: ["La sensibilización y visibilización de la orientación sexual", "La heterogeneidad y diversidad familiar", "Las necesidades específicas y la vulnerabilidad", "Ninguna es correcta"],
                correct: "La heterogeneidad y diversidad familiar"
            },
            {
                question: "¿Cuál de los siguientes ámbitos NO es una prioridad en la protección de los derechos de las personas LGTBI?",
                options: ["Promoción del turismo", "Protección internacional", "Cooperación entre administraciones", "Familia, infancia y juventud"],
                correct: "Cooperación entre administraciones"
            },
            {
                question: "¿Qué tipo de trato se garantiza a las personas trans conforme a su identidad?",
                options: ["Trato conforme a su identidad", "Defensa de sus derechos trans", "Educación inclusiva", "Todas son correctas"],
                correct: "Trato conforme a su identidad"
            },
            {
                question: "¿Qué principio es fundamental en la atención a la diversidad de género, evitando la consideración de la identidad como una patología?",
                options: ["Consentimiento informado", "No segregación", "Patologización", "Objetivo diagnóstico"],
                correct: "Objetivo diagnóstico"
            },
            {
                question: "¿Cómo se puede realizar la rectificación de la mención registral del sexo de una persona menor de edad?",
                options: ["Mediante autorización judicial", "Mediante el nombramiento de un defensor judicial", "Mediante autorización de sus representantes legales", "Ninguna es correcta"],
                correct: "Ninguna es correcta"
            },
            {
                question: "¿Quién es el encargado de la rectificación de la mención registral del sexo?",
                options: ["El encargado del Registro Civil", "Dirección General de Seguridad jurídica y fe pública", "Autoridad independiente para la Igualdad de trato y no discriminación", "Conferencia sectorial de Igualdad"],
                correct: "Dirección General de Seguridad jurídica y fe pública"
            },
            {
                question: "¿Qué afirmación es correcta sobre la Autoridad independiente para la Igualdad de trato y no discriminación?",
                options: ["Depende del Ministerio de la Presidencia", "Presenta una memoria de su actividad de carácter trimestral", "Se remite dicha memoria a las Cortes Generales", "Todas son correctas"],
                correct: "Se remite dicha memoria a las Cortes Generales"
            },
            {
                question: "¿Qué requisito es indispensable para cualquier intervención médica en el proceso de rectificación registral del sexo?",
                options: ["Necesita el consentimiento de la persona interesada o de su representante legal", "Necesita de una campaña de desestigmatización para una educación sexual y reproductiva", "Está prohibida por ser una terapia de contracondicionamiento", "Se supedita a una rectificación registral"],
                correct: "Está prohibida por ser una terapia de contracondicionamiento"
            },
            {
                question: "¿Qué derecho se conserva al rectificar la mención registral del sexo de femenino a masculino, si se derivan de medidas de acción positiva?",
                options: [
                    "Permite a la persona ejercer todos los derechos inherentes a su nueva condición",
                    "Podrá ser beneficiaria de medidas de acción positiva en favor de las mujeres si el cambio es a sexo femenino",
                    "Respecto a las situaciones jurídicas que traigan causa del sexo registral en el momento del nacimiento, la persona no perderá, en su caso, los derechos inherentes al mismo",
                    "La persona que rectifique la mención registral pasando del sexo femenino al masculino conservará los derechos patrimoniales consolidados que se hayan derivado de estas medidas de acción positiva, dando lugar a su reintegro o devolución."
                ],
                correct: "La persona que rectifique la mención registral pasando del sexo femenino al masculino conservará los derechos patrimoniales consolidados que se hayan derivado de estas medidas de acción positiva, dando lugar a su reintegro o devolución."
            },
            {
                question: "¿Qué se requiere para la reversibilidad de la mención registral?",
                options: [
                    "A la reversibilidad de la mención registral",
                    "A la reexpedición del documento de una autoridad o institución pública",
                    "Al cobro de las tasas, siempre que se adecuen al principio de capacidad económica",
                    "Expedición de un nuevo DNI"
                ],
                correct: "Expedición de un nuevo DNI"
            },
            {
                question: "¿Qué medida es necesaria para evaluar la eficacia y el grado de cumplimiento de las políticas de igualdad?",
                options: [
                    "Un informe de evaluación intermedia",
                    "Medidas de acción positiva",
                    "Un estudio necesario para conocer la situación socioeconómica",
                    "Una adecuada evaluación y seguimiento para evaluar la eficacia y el grado de cumplimiento"
                ],
                correct: "Medidas de acción positiva"
            },
            {
                question: "¿Qué acción se requiere para la ratificación de la solicitud de rectificación registral?",
                options: [
                    "Se solicitará un informe médico o psicológico",
                    "Se dará audiencia a la persona legitimada para que ratifique su solicitud",
                    "Se aseverará la persistencia de su decisión",
                    "Se suscribirá, con su conformidad, la comparecencia inicial reiterando su petición de rectificación registral"
                ],
                correct: "Se suscribirá, con su conformidad, la comparecencia inicial reiterando su petición de rectificación registral"
            },
            {
                question: "¿En qué caso se puede conservar el anterior folio registral tras una rectificación?",
                options: [
                    "Siempre que se decida la previa rectificación",
                    "En cualquier caso",
                    "Siempre que se traslade por folio registral",
                    "Salvo que se decida conservar el anterior a tenor de los previsto en la normativa del Registro Civil"
                ],
                correct: "Salvo que se decida conservar el anterior a tenor de los previsto en la normativa del Registro Civil"
            },
            {
                question: "¿Cuándo se puede solicitar la rectificación registral por una persona menor de edad?",
                options: [
                    "Siempre que se haga a solicitud de la persona menor de edad",
                    "Solo en los casos en que indicaciones médicas lo exijan",
                    "Siempre que por la madurez del menor se pueda consentir de manera informada",
                    "Siempre que no se comprometa su capacidad reproductora"
                ],
                correct: "Siempre que por la madurez del menor se pueda consentir de manera informada"
            },
            {
                question: "¿Cuál de los siguientes servicios NO está relacionado con el apoyo a personas LGTBI?",
                options: ["Orientación jurídica", "Servicios de mediación comunicativa", "Movilidad geográfica y cambio de centro de trabajo", "Servicios de traducción"],
                correct: "Movilidad geográfica y cambio de centro de trabajo"
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = []; // Stores the selected option index for each question
        let quizCompleted = false;

        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');
        const questionCounter = document.getElementById('question-counter');
        const quizContainer = document.getElementById('quiz-container');
        const resultsSummary = document.getElementById('results-summary');
        const correctCountElement = document.getElementById('correct-count');
        const incorrectCountElement = document.getElementById('incorrect-count');
        const unansweredCountElement = document.getElementById('unanswered-count');
        const retakeBtn = document.getElementById('retake-btn');

        /**
         * Loads the quiz state from localStorage.
         * If no state is found, initializes a new state.
         */
        function loadQuizState() {
            const savedState = localStorage.getItem('quizState');
            if (savedState) {
                const state = JSON.parse(savedState);
                currentQuestionIndex = state.currentQuestionIndex;
                userAnswers = state.userAnswers;
                quizCompleted = state.quizCompleted;
            } else {
                // Initialize userAnswers array with nulls for each question
                userAnswers = new Array(quizData.length).fill(null);
                currentQuestionIndex = 0;
                quizCompleted = false;
            }
        }

        /**
         * Saves the current quiz state to localStorage.
         */
        function saveQuizState() {
            const state = {
                currentQuestionIndex: currentQuestionIndex,
                userAnswers: userAnswers,
                quizCompleted: quizCompleted
            };
            localStorage.setItem('quizState', JSON.stringify(state));
        }

        /**
         * Renders the current question and its options.
         */
        function renderQuestion() {
            if (quizCompleted) {
                showResults();
                return;
            }

            const question = quizData[currentQuestionIndex];
            questionTextElement.textContent = question.question;
            optionsContainer.innerHTML = ''; // Clear previous options
            feedbackElement.classList.add('hidden'); // Hide feedback

            question.options.forEach((option, index) => {
                const optionId = `option-${index}`;
                const isSelected = userAnswers[currentQuestionIndex] === index;

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.className = 'option-label flex items-start px-4 py-3 rounded-md mb-2 cursor-pointer transition-colors duration-200 ease-in-out hover:bg-blue-50';

                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'answer';
                radio.id = optionId;
                radio.value = index;
                radio.className = 'mr-3 mt-1'; // Tailwind for margin-right and margin-top for alignment
                radio.checked = isSelected;
                radio.disabled = userAnswers[currentQuestionIndex] !== null; // Disable if already answered

                const span = document.createElement('span');
                span.textContent = option;
                span.className = 'text-gray-700 text-base flex-grow'; // flex-grow to make text take available space

                label.appendChild(radio);
                label.appendChild(span);
                optionsContainer.appendChild(label);

                // Add event listener for option selection
                radio.addEventListener('change', (event) => {
                    if (event.target.checked) {
                        handleAnswerSelection(index);
                    }
                });

                // Apply feedback styling if already answered
                if (isSelected) {
                    applyFeedbackStyling(index);
                }
            });

            updateNavigationButtons();
            updateQuestionCounter();
            saveQuizState(); // Save state after rendering
        }

        /**
         * Handles user's answer selection.
         * @param {number} selectedOptionIndex - The index of the selected option.
         */
        function handleAnswerSelection(selectedOptionIndex) {
            userAnswers[currentQuestionIndex] = selectedOptionIndex;
            const question = quizData[currentQuestionIndex];
            const isCorrect = question.options[selectedOptionIndex] === question.correct;

            // Disable all radio buttons for the current question
            document.querySelectorAll('#options-container input[type="radio"]').forEach(radio => {
                radio.disabled = true;
            });

            // Show feedback message
            feedbackElement.classList.remove('hidden');
            feedbackElement.classList.remove('feedback-correct', 'feedback-incorrect');

            if (isCorrect) {
                feedbackElement.textContent = '¡Correcto!';
                feedbackElement.classList.add('feedback-correct');
            } else {
                feedbackElement.textContent = `Incorrecto. La respuesta correcta era: "${question.correct}"`;
                feedbackElement.classList.add('feedback-incorrect');
            }

            applyFeedbackStyling(selectedOptionIndex); // Apply styling to the selected option
            saveQuizState(); // Save state after answer
        }

        /**
         * Applies visual feedback styling to options.
         * @param {number} selectedOptionIndex - The index of the selected option.
         */
        function applyFeedbackStyling(selectedOptionIndex) {
            const question = quizData[currentQuestionIndex];
            question.options.forEach((option, index) => {
                const label = optionsContainer.children[index];
                label.classList.remove('correct-answer', 'incorrect-answer'); // Clear previous styling

                if (question.options[index] === question.correct) {
                    label.classList.add('correct-answer'); // Mark correct answer
                } else if (index === selectedOptionIndex && question.options[index] !== question.correct) {
                    label.classList.add('incorrect-answer'); // Mark incorrect selected answer
                }
            });
        }

        /**
         * Updates the visibility and state of navigation buttons.
         */
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === quizData.length - 1 && !quizCompleted;

            if (currentQuestionIndex === quizData.length - 1 && userAnswers[currentQuestionIndex] !== null) {
                nextBtn.textContent = 'Finalizar Test';
            } else {
                nextBtn.textContent = 'Siguiente';
            }
        }

        /**
         * Updates the question counter display.
         */
        function updateQuestionCounter() {
            questionCounter.textContent = `Pregunta ${currentQuestionIndex + 1} de ${quizData.length}`;
        }

        /**
         * Navigates to the next question or shows results if at the end.
         */
        function goToNextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else if (currentQuestionIndex === quizData.length - 1) {
                quizCompleted = true;
                saveQuizState();
                showResults();
            }
        }

        /**
         * Navigates to the previous question.
         */
        function goToPrevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        /**
         * Calculates and displays the test results.
         */
        function showResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            let unansweredCount = 0;

            userAnswers.forEach((answerIndex, index) => {
                if (answerIndex === null) {
                    unansweredCount++;
                } else {
                    const question = quizData[index];
                    if (question.options[answerIndex] === question.correct) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }
            });

            correctCountElement.textContent = correctCount;
            incorrectCountElement.textContent = incorrectCount;
            unansweredCountElement.textContent = unansweredCount;

            quizContainer.classList.add('hidden');
            resultsSummary.classList.remove('hidden');
        }

        /**
         * Resets the quiz to its initial state.
         */
        function resetQuiz() {
            localStorage.removeItem('quizState');
            currentQuestionIndex = 0;
            userAnswers = new Array(quizData.length).fill(null);
            quizCompleted = false;
            quizContainer.classList.remove('hidden');
            resultsSummary.classList.add('hidden');
            renderQuestion();
        }

        // Event Listeners
        prevBtn.addEventListener('click', goToPrevQuestion);
        nextBtn.addEventListener('click', goToNextQuestion);
        restartBtn.addEventListener('click', resetQuiz);
        retakeBtn.addEventListener('click', resetQuiz);

        // Initial load
        window.onload = () => {
            loadQuizState();
            renderQuestion();
        };
    </script>
</body>
</html>

