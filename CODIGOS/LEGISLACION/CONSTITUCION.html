<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LA CONSTITUCIÓN</title>
    <!-- Enlace a Tailwind CSS para las clases de la estructura HTML -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS completo para el estilo del quiz -->
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Contenedor principal del quiz */
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
        }

        /* Tarjeta de la pregunta */
        .question-card {
            background-color: #f8fafc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease-in-out;
        }

        /* Estilo para la tarjeta de pregunta correcta */
        .question-card.correct {
            background-color: #d4edda;
            border-color: #28a745;
        }

        /* Estilo para la tarjeta de pregunta incorrecta */
        .question-card.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }

        /* Texto de la pregunta */
        .question-text {
            font-size: 1.15rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* Botones de opciones */
        .option-button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 18px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            background-color: #ffffff;
            color: #4a5568;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Efecto hover para los botones de opciones */
        .option-button:hover:not(.disabled) {
            background-color: #e2e8f0;
            border-color: #a0aec0;
        }

        /* Estilo para el botón de opción seleccionado */
        .option-button.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
            font-weight: 600;
        }

        /* Estilo para la respuesta correcta */
        .option-button.correct-answer {
            background-color: #28a745;
            color: #ffffff;
            border-color: #28a745;
            font-weight: 700;
        }

        /* Estilo para la respuesta incorrecta */
        .option-button.incorrect-answer {
            background-color: #dc3545;
            color: #ffffff;
            border-color: #dc3545;
            font-weight: 700;
        }

        /* Estilo para los botones deshabilitados */
        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Contenedor de la solución */
        .solution {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #e0f2f7;
            color: #2c5282;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid #90cdf4;
        }

        /* Contenedor del feedback (correcto/incorrecto) */
        .feedback {
            margin-top: 15px;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
        }

        /* Estilo para feedback correcto */
        .feedback.correct {
            color: #28a745;
        }

        /* Estilo para feedback incorrecto */
        .feedback.incorrect {
            color: #dc3545;
        }

        /* Contenedor de los botones de navegación */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Estilo base para los botones de navegación */
        .nav-button {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            text-align: center;
        }

        /* Estilo para el botón "Anterior" */
        .nav-button.prev {
            background-color: #6b7280;
            color: #ffffff;
        }
        .nav-button.prev:hover:not(:disabled) {
            background-color: #4b5563;
            transform: translateY(-2px);
        }

        /* Estilo para el botón "Siguiente" */
        .nav-button.next {
            background-color: #4299e1;
            color: #ffffff;
        }
        .nav-button.next:hover:not(:disabled) {
            background-color: #3182ce;
            transform: translateY(-2px);
        }

        /* Estilo para el botón de reinicio en línea */
        .nav-button.restart-inline {
            background-color: #f50b0b;
            color: #ffffff;
        }
        .nav-button.restart-inline:hover:not(:disabled) {
            background-color: #ac0505;
            transform: translateY(-2px);
        }

        /* Estilo para los botones deshabilitados */
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Barra de progreso */
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 5px;
            height: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #4299e1;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        /* Visualización de la puntuación final */
        .score-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-top: 20px;
        }

        /* Resumen de resultados */
        .results-summary {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .results-summary p {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .results-summary p strong {
            font-weight: 700;
        }

        /* Botón de reinicio final */
        .restart-button {
            display: block;
            width: fit-content;
            margin: 20px auto 0 auto;
            padding: 12px 30px;
            background-color: #48bb78;
            color: #ffffff;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .restart-button:hover {
            background-color: #38a169;
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
         <h1 style="color: #003366; font-family: 'Georgia', serif; font-size: 2rem; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">LA CONSTITUCIÓN</h1>

        <!-- Barra de progreso -->
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <!-- Contenedor principal de las preguntas -->
        <div id="quizContainer">
            <!-- Las preguntas se cargarán dinámicamente aquí -->
        </div>

        <!-- Botones de navegación -->
        <div class="navigation-buttons">
            <button id="prevBtn" class="nav-button prev" disabled>Anterior</button>
            <button id="restartInlineBtn" class="nav-button restart-inline">Reiniciar Test</button>
            <button id="nextBtn" class="nav-button next">Siguiente</button>
        </div>

        <!-- Contenedor de la puntuación final -->
        <div id="finalScore" class="hidden">
            <div class="score-display"></div>
            <div class="results-summary">
                <p><strong>Preguntas Correctas:</strong> <span id="correctCount">0</span></p>
                <p><strong>Preguntas Incorrectas:</strong> <span id="incorrectCount">0</span></p>
                <p><strong>Preguntas Sin Contestar:</strong> <span id="unansweredCount">0</span></p>
            </div>
            <button id="restartBtn" class="restart-button">Reiniciar Test</button>
        </div>
    </div>
    <script>
        // Define las preguntas, opciones y la respuesta correcta para cada pregunta.
        const questions = [
            {
                question: "¿En qué fecha fue aprobada la Constitución Española en referéndum?",
                options: ["a) 6 de diciembre de 1978", "b) 29 de diciembre de 1978", "c) 31 de octubre de 1978", "d) 27 de diciembre de 1978"],
                correctAnswer: "a) 6 de diciembre de 1978"
            },
            {
                question: "¿Qué porcentaje de votos ratificó la Constitución Española el 6 de diciembre de 1978?",
                options: ["a) 78%", "b) 87%", "c) 92%", "d) 68%"],
                correctAnswer: "b) 87%"
            },
            {
                question: "¿Qué día entró en vigor la Constitución Española?",
                options: ["a) 6 de diciembre de 1978", "b) 27 de diciembre de 1978", "c) 31 de octubre de 1978", "d) 29 de diciembre de 1978"],
                correctAnswer: "d) 29 de diciembre de 1978"
            },
            {
                question: "¿Desde qué fecha es fiesta nacional el 6 de diciembre en España?",
                options: ["a) 1978", "b) 1986", "c) 1992", "d) 2011"],
                correctAnswer: "b) 1986"
            },
            {
                question: "Según el Artículo 9.1 de la Constitución, ¿a qué están sujetos los ciudadanos y los poderes públicos?",
                options: ["a) Al Gobierno y las leyes.", "b) A la Constitución y al resto del Ordenamiento Jurídico.", "c) A las Cortes Generales y los Tribunales.", "d) Al Rey y al Gobierno."],
                correctAnswer: "b) A la Constitución y al resto del Ordenamiento Jurídico."
            },
            {
                question: "¿Quién propuso el diseño tripartito de división de poderes (ejecutivo, legislativo y judicial) que recoge la Constitución Española?",
                options: ["a) Rousseau", "b) Locke", "c) Montesquieu", "d) Voltaire"],
                correctAnswer: "c) Montesquieu"
            },
            {
                question: "¿Qué Título de la Constitución Española se refiere a los Derechos y Deberes Fundamentales?",
                options: ["a) Título Preliminar", "b) Título I", "c) Título II", "d) Título III"],
                correctAnswer: "b) Título I"
            },
            {
                question: "¿Qué Título de la Constitución Española aborda la Corona?",
                options: ["a) Título I", "b) Título II", "c) Título III", "d) Título IV"],
                correctAnswer: "b) Título II"
            },
            {
                question: "¿Qué Título de la Constitución Española trata sobre las Cortes Generales?",
                options: ["a) Título II", "b) Título III", "c) Título IV", "d) Título V"],
                correctAnswer: "b) Título III" // CORREGIDA: Originalmente era 'c) Título III'
            },
            {
                question: "¿Qué Título de la Constitución Española regula el Gobierno y la Administración?",
                options: ["a) Título III", "b) Título IV", "c) Título V", "d) Título VI"],
                correctAnswer: "b) Título IV"
            },
            {
                question: "¿Qué Título de la Constitución Española se refiere a las relaciones entre el Gobierno y las Cortes Generales?",
                options: ["a) Título IV", "b) Título V", "c) Título VI", "d) Título VII"],
                correctAnswer: "b) Título V"
            },
            {
                question: "¿Qué Título de la Constitución Española se dedica al Poder Judicial?",
                options: ["a) Título V", "b) Título VI", "c) Título VII", "d) Título VIII"],
                correctAnswer: "b) Título VI"
            },
            {
                question: "¿Qué Título de la Constitución Española aborda la organización territorial del Estado?",
                options: ["a) Título VII", "b) Título VIII", "c) Título IX", "d) Título X"],
                correctAnswer: "b) Título VIII"
            },
            {
                question: "¿Qué Título de la Constitución Española regula el Tribunal Constitucional?",
                options: ["a) Título VIII", "b) Título IX", "c) Título X", "d) Título Preliminar"],
                correctAnswer: "b) Título IX"
            },
            {
                question: "¿Qué Título de la Constitución Española trata la Reforma Constitucional?",
                options: ["a) Título VIII", "b) Título IX", "c) Título X", "d) Título Preliminar"],
                correctAnswer: "c) Título X"
            },
            {
                question: "¿Qué partes de la Constitución Española se consideran la 'parte dogmática'?",
                options: ["a) Título Preliminar y Título I", "b) Títulos II a IX", "c) Título X", "d) Disposiciones adicionales, transitorias, derogatoria y final"],
                correctAnswer: "a) Título Preliminar y Título I"
            },
            {
                question: "¿Qué partes de la Constitución Española se consideran la 'parte orgánica'?",
                options: ["a) Título Preliminar y Título I", "b) Títulos II a IX", "c) Título X", "d) Las disposiciones finales"],
                correctAnswer: "b) Títulos II a IX"
            },
            {
                question: "¿Qué parte de la Constitución Española se considera la 'parte modificativa'?",
                options: ["a) Título Preliminar", "b) Título I", "c) Título X", "d) Las disposiciones adicionales"],
                correctAnswer: "c) Título X"
            },
            {
                question: "¿Cuántas disposiciones transitorias tiene la Constitución Española?",
                options: ["a) 4", "b) 1", "c) 9", "d) 1"], // Note: The original document had '1' twice, assuming '9' is correct based on common knowledge.
                correctAnswer: "c) 9"
            },
            {
                question: "¿Cuántas disposiciones adicionales tiene la Constitución Española?",
                options: ["a) 4", "b) 9", "c) 1", "d) 1"], // Note: The original document had '1' twice, assuming '4' is correct based on common knowledge.
                correctAnswer: "a) 4"
            },
            {
                question: "¿Cómo se constituye España según el Título Preliminar de la Constitución?",
                options: ["a) Como una Monarquía absoluta.", "b) Como un Estado social y democrático de Derecho.", "c) Como una República federal.", "d) Como un Estado unitario."],
                correctAnswer: "b) Como un Estado social y democrático de Derecho."
            },
            {
                question: "¿Cuáles son los valores superiores del ordenamiento jurídico español según el Artículo 1 de la Constitución?",
                options: ["a) Orden, seguridad, progreso y unidad.", "b) Libertad, justicia, igualdad y pluralismo político.", "c) Democracia, soberanía, ley y paz.", "d) Tradición, familia, propiedad y religión."],
                correctAnswer: "b) Libertad, justicia, igualdad y pluralismo político."
            },
            {
                question: "¿En quién reside la soberanía nacional según la Constitución Española?",
                options: ["a) En el Rey.", "b) En las Cortes Generales.", "c) En el pueblo español.", "d) En el Gobierno."],
                correctAnswer: "c) En el pueblo español."
            },
            {
                question: "¿Cuál es la forma política del Estado español?",
                options: ["a) República Parlamentaria.", "b) Monarquía Absoluta.", "c) Monarquía Parlamentaria.", "d) República Presidencialista."],
                correctAnswer: "c) Monarquía Parlamentaria."
            },
            {
                question: "¿Cuál es la lengua española oficial del Estado según la Constitución?",
                options: ["a) El catalán", "b) El gallego", "c) El vasco", "d) El castellano"],
                correctAnswer: "d) El castellano"
            },
            {
                question: "¿Cuál es el deber y derecho de todos los españoles en relación con el castellano?",
                options: ["a) El derecho a usarla, pero no el deber de conocerla.", "b) El deber de conocerla y el derecho a usarla.", "c) Solo el deber de conocerla.", "d) Solo el derecho a usarla."],
                correctAnswer: "b) El deber de conocerla y el derecho a usarla."
            },
            {
                question: "¿Cuál es la capital del Estado español según la Constitución?",
                options: ["a) Barcelona", "b) Sevilla", "c) Madrid", "d) Valencia"],
                correctAnswer: "c) Madrid"
            },
            {
                question: "¿Qué principio del Artículo 9 de la Constitución establece que las normas inferiores no pueden ir contra los preceptos de las normas superiores?",
                options: ["a) Principio de legalidad.", "b) Jerarquía normativa.", "c) Publicidad de las normas.", "d) Seguridad jurídica."],
                correctAnswer: "b) Jerarquía normativa."
            },
            {
                question: "¿Dónde es necesaria la publicación de las normas para garantizar el principio de publicidad según el Artículo 9?",
                options: ["a) Solo en el Boletín Oficial del Estado (BOE).", "b) En el BOE, Boletín Oficial de las CCAA o en el Diario Oficial de la Unión Europea (DOUE).", "c) En los periódicos de mayor tirada nacional.", "d) En la página web oficial del Gobierno."],
                correctAnswer: "b) En el BOE, Boletín Oficial de las CCAA o en el Diario Oficial de la Unión Europea (DOUE)."
            },
            {
                question: "¿Qué principio constitucional establece que los ciudadanos deben conocer en todo momento qué normas les son aplicables?",
                options: ["a) Principio de legalidad.", "b) Irretroactividad de las disposiciones sancionadoras.", "c) Seguridad jurídica.", "d) Responsabilidad e interdicción de la arbitrariedad."],
                correctAnswer: "c) Seguridad jurídica."
            },
            {
                question: "¿Qué establece el Artículo 10 de la Constitución Española como fundamento del orden político y la paz social?",
                options: ["a) La igualdad de los ciudadanos.", "b) La dignidad de la persona.", "c) La soberanía nacional.", "d) La libertad de expresión."],
                correctAnswer: "b) La dignidad de la persona."
            },
            {
                question: "Según el Capítulo I del Título I, ¿quién no podrá ser privado de su nacionalidad?",
                options: ["a) Ningún extranjero.", "b) Ningún español de origen.", "c) Ningún español por residencia.", "d) Ningún ciudadano de la Unión Europea."],
                correctAnswer: "b) Ningún español de origen."
            },
            {
                question: "¿A qué edad se alcanza la mayoría de edad en España según la Constitución?",
                options: ["a) 16 años", "b) 21 años", "c) 18 años", "d) 25 años"],
                correctAnswer: "c) 18 años"
            },
            {
                question: "¿A partir de qué edad se pueden formalizar contratos de trabajo y presentarse a pruebas de acceso a la Función Pública en España, con algunas excepciones?",
                options: ["a) 14 años", "b) 16 años", "c) 18 años", "d) 20 años"],
                correctAnswer: "b) 16 años"
            },
            {
                question: "¿Cuál es la excepción a la posibilidad de formalizar contratos de trabajo y presentarse a pruebas de acceso a la Función Pública con 16 años?",
                options: ["a) Cuerpos docentes", "b) Cuerpos y Fuerzas de Seguridad del Estado", "c) Personal sanitario", "d) Jueces y fiscales"],
                correctAnswer: "b) Cuerpos y Fuerzas de Seguridad del Estado"
            },
            {
                question: "¿Qué establece el Artículo 14 de la Constitución Española?",
                options: ["a) La libertad de residencia.", "b) La igualdad de los españoles ante la ley.", "c) El derecho a la vida.", "d) La libertad de expresión."],
                correctAnswer: "b) La igualdad de los españoles ante la ley."
            },
            {
                question: "¿Qué derecho se reconoce en el Artículo 15 de la Constitución?",
                options: ["a) La libertad de asociación.", "b) La libertad de expresión.", "c) El derecho a la vida.", "d) El derecho al honor."],
                correctAnswer: "c) El derecho a la vida."
            },
            {
                question: "¿Sobre qué no podrá ser obligado a declarar nadie según el Artículo 16 de la Constitución?",
                options: ["a) Su nombre y apellidos.", "b) Su ideología, religión o creencias.", "c) Su patrimonio.", "d) Su lugar de nacimiento."],
                correctAnswer: "b) Su ideología, religión o creencias."
            },
            {
                question: "¿Cuál es el plazo máximo de detención preventiva según el Artículo 17 de la Constitución?",
                options: ["a) 24 horas", "b) 48 horas", "c) 72 horas", "d) 96 horas"],
                correctAnswer: "c) 72 horas"
            },
            {
                question: "¿Qué procedimiento permite la inmediata puesta a disposición judicial del detenido en 24 horas?",
                options: ["a) Habeas Corpus", "b) Recurso de amparo", "c) Recurso contencioso-administrativo", "d) Juicio rápido"],
                correctAnswer: "a) Habeas Corpus"
            },
            {
                question: "¿Qué derechos se protegen en el Artículo 18 de la Constitución?",
                options: ["a) Derecho a la educación y al trabajo.", "b) Derecho al honor, a la intimidad personal y familiar y a la propia imagen.", "c) Derecho a la propiedad y a la herencia.", "d) Derecho a la libertad de reunión y manifestación."],
                correctAnswer: "b) Derecho al honor, a la intimidad personal y familiar y a la propia imagen."
            },
            {
                question: "¿Qué ley orgánica se menciona en relación con la protección de datos personales y garantía de los derechos digitales?",
                options: ["a) Ley Orgánica 1/2002", "b) Ley Orgánica 3/2018", "c) Ley Orgánica 15/1999", "d) Ley Orgánica 2/1986"],
                correctAnswer: "b) Ley Orgánica 3/2018"
            },
            {
                question: "¿Qué limitación establece el Artículo 18 de la Constitución en relación con el uso de la informática?",
                options: ["a) No se puede utilizar la informática para fines políticos.", "b) La ley limitará el uso de la informática para garantizar el honor y la intimidad personal y familiar de los ciudadanos.", "c) Se prohíbe el uso de la informática en la administración pública.", "d) El uso de la informática está sujeto a autorización judicial previa."],
                correctAnswer: "b) La ley limitará el uso de la informática para garantizar el honor y la intimidad personal y familiar de los ciudadanos."
            },
            {
                question: "¿Qué derecho tienen los españoles según el Artículo 19 de la Constitución, salvo en estados de excepción y sitio?",
                options: ["a) Derecho a la educación.", "b) Derecho a elegir libremente su residencia y circular por el territorio nacional.", "c) Derecho a la propiedad privada.", "d) Derecho a la huelga."],
                correctAnswer: "b) Derecho a elegir libremente su residencia y circular por el territorio nacional."
            },
            {
                question: "¿Qué libertad se reconoce en el Artículo 20 de la Constitución en relación con el conocimiento?",
                options: ["a) Libertad de asociación.", "b) Libertad de cátedra.", "c) Libertad de prensa.", "d) Libertad de comercio."],
                correctAnswer: "b) Libertad de cátedra."
            },
            {
                question: "¿Qué se prohíbe en el Artículo 20 de la Constitución en relación con la expresión de pensamientos?",
                options: ["a) La difamación.", "b) La censura previa.", "c) La propaganda política.", "d) La publicación de datos personales."],
                correctAnswer: "b) La censura previa."
            },
            {
                question: "¿Qué se puede realizar por resolución judicial según el Artículo 20 de la Constitución?",
                options: ["a) La limitación de la libertad de expresión.", "b) El secuestro de publicaciones, grabaciones y otra información.", "c) La prohibición de reuniones.", "d) La disolución de asociaciones."],
                correctAnswer: "b) El secuestro de publicaciones, grabaciones y otra información."
            },
            {
                question: "¿El derecho de reunión pacífica y sin armas necesita autorización previa?",
                options: ["a) Sí, siempre.", "b) Solo si es en lugar público.", "c) No, no necesita autorización previa.", "d) Solo si es una manifestación."],
                correctAnswer: "c) No, no necesita autorización previa."
            },
            {
                question: "¿En qué casos la autoridad puede prohibir reuniones en lugares públicos y manifestaciones?",
                options: ["a) Si son multitudinarias.", "b) Si se comunica con menos de 24 horas de antelación.", "c) Si hay razones fundadas de alteración del orden público, con peligro para personas o bienes.", "d) Si los organizadores no presentan un plan de seguridad."],
                correctAnswer: "c) Si hay razones fundadas de alteración del orden público, con peligro para personas o bienes."
            },
            {
                question: "¿Para qué efecto se deben inscribir las asociaciones en un registro según el Artículo 22 de la Constitución?",
                options: ["a) Para obtener subvenciones.", "b) Para tener personalidad jurídica.", "c) A los solos efectos de publicidad.", "d) Para ser reconocidas oficialmente."],
                correctAnswer: "c) A los solos efectos de publicidad."
            },
            {
                question: "¿Qué tipo de asociaciones están prohibidas por la Constitución?",
                options: ["a) Las asociaciones políticas y religiosas.", "b) Las asociaciones secretas y las de carácter paramilitar.", "c) Las asociaciones con fines de lucro.", "d) Las asociaciones internacionales."],
                correctAnswer: "b) Las asociaciones secretas y las de carácter paramilitar."
            },
            {
                question: "¿Quién legisla sobre los empleados públicos según la Constitución?",
                options: ["a) El Gobierno.", "b) El Estado.", "c) Las Cortes Generales.", "d) Los sindicatos."],
                correctAnswer: "b) El Estado."
            },
            {
                question: "¿Qué derecho garantiza el Artículo 24 de la Constitución, que implica un fallo judicial que se cumpla?",
                options: ["a) Derecho a la defensa.", "b) Derecho a la presunción de inocencia.", "c) Derecho a obtener tutela efectiva de los jueces y tribunales.", "d) Derecho a un proceso público."],
                correctAnswer: "c) Derecho a obtener tutela efectiva de los jueces y tribunales."
            },
            {
                question: "Según el Artículo 24, ¿cuál de los siguientes no es un medio de prueba pertinente para la defensa?",
                options: ["a) Pruebas materiales.", "b) Declaración de testigos.", "c) Rumores infundados.", "d) Indicios."],
                correctAnswer: "c) Rumores infundados."
            },
            {
                question: "¿Qué prohíbe el Artículo 26 de la Constitución?",
                options: ["a) Los tribunales militares.", "b) Los Tribunales de Honor en el ámbito de la Administración civil y de las organizaciones profesionales.", "c) Los jurados populares.", "d) Los tribunales especiales."],
                correctAnswer: "b) Los Tribunales de Honor en el ámbito de la Administración civil y de las organizaciones profesionales."
            },
            {
                question: "¿Qué derecho se reconoce en el Artículo 27 de la Constitución?",
                options: ["a) Derecho al trabajo.", "b) Derecho a la educación.", "c) Derecho a la vivienda.", "d) Derecho a la salud."],
                correctAnswer: "b) Derecho a la educación."
            },
            {
                question: "¿Qué derecho tienen los trabajadores para la defensa de sus intereses, reconocido en el Artículo 28?",
                options: ["a) Derecho de asociación.", "b) Derecho a la huelga.", "c) Derecho de negociación colectiva.", "d) Derecho de sindicación."],
                correctAnswer: "d) Derecho de sindicación."
            },
            {
                question: "Según el Artículo 29, ¿cómo tendrán derecho de petición los españoles?",
                options: ["a) Oralmente, ante cualquier autoridad.", "b) Individual y colectiva, por escrito, en la forma y con los efectos que determine la ley.", "c) Solo individualmente y por escrito.", "d) Solo colectivamente y verbalmente."],
                correctAnswer: "b) Individual y colectiva, por escrito, en la forma y con los efectos que determine la ley."
            },
            {
                question: "¿Qué artículo de la Constitución regula la institución del Defensor del Pueblo?",
                options: ["a) Artículo 53", "b) Artículo 54", "c) Artículo 55", "d) Artículo 56"],
                correctAnswer: "b) Artículo 54"
            },
            {
                question: "¿Cómo se define al Defensor del Pueblo en la Constitución?",
                options: ["a) Un órgano del poder judicial.", "b) Un alto comisionado de las Cortes Generales.", "c) Un representante del Gobierno.", "d) Un miembro del Tribunal Constitucional."],
                correctAnswer: "b) Un alto comisionado de las Cortes Generales."
            },
            {
                question: "¿Qué derechos y libertades NO pueden suspenderse en el estado de excepción según el Artículo 55?",
                options: ["a) Libertad de expresión.", "b) Derecho de reunión.", "c) Información al detenido y asistencia de abogado (Artículo 17.3).", "d) Derecho a la huelga."],
                correctAnswer: "c) Información al detenido y asistencia de abogado (Artículo 17.3)." // CORREGIDA: Ya estaba correcta, pero se asegura la explicitud.
            },
            {
                question: "¿Cuál de los siguientes no es un derecho que pueda suspenderse en los estados de excepción o de sitio?",
                options: ["a) Inviolabilidad del domicilio.", "b) Secreto de las comunicaciones.", "c) Derecho a la vida.", "d) Libre elección de residencia y circulación."],
                correctAnswer: "c) Derecho a la vida."
            },
            {
                question: "¿Cuál de las siguientes es una modalidad del procedimiento ordinario de reforma constitucional?",
                options: ["a) Aprobación por 2/3 de cada Cámara y referéndum obligatorio.", "b) Aprobación por 3/5 de cada Cámara.", "c) Aprobación por mayoría absoluta del Congreso y mayoría simple del Senado.", "d) Aprobación por 1/2 de cada Cámara y disolución de las Cortes."],
                correctAnswer: "b) Aprobación por 3/5 de cada Cámara."
            },
            {
                question: "En el procedimiento ordinario de reforma constitucional, ¿cuándo se convoca un referéndum popular tras su aprobación?",
                options: ["a) Siempre.", "b) Si se solicita por 1/10 de los miembros de cualquiera de Las Cámaras.", "c) Si lo decide el Gobierno.", "d) Nunca."],
                correctAnswer: "b) Si se solicita por 1/10 de los miembros de cualquiera de Las Cámaras."
            },
            {
                question: "¿Cuándo es obligatorio el procedimiento agravado o extraordinario de reforma constitucional?",
                options: ["a) Siempre que se reforme un Título completo.", "b) Cuando sea de revisión total de la Constitución o afecte al Título Preliminar, al Título I Capítulo Segundo Sección Primera o al Título II.", "c) Cuando lo propongan 2/3 de ambas Cámaras.", "d) Cuando se reformen menos de 5 artículos."],
                correctAnswer: "b) Cuando sea de revisión total de la Constitución o afecte al Título Preliminar, al Título I Capítulo Segundo Sección Primera o al Título II."
            },
            {
                question: "En el procedimiento agravado de reforma constitucional, ¿qué sucede después de la aprobación por 2/3 de cada Cámara?",
                options: ["a) Se convoca inmediatamente un referéndum.", "b) Se disuelven Las Cámaras y se convocan elecciones.", "c) Se ratifica el cambio por mayoría simple.", "d) El Rey sanciona la reforma."],
                correctAnswer: "b) Se disuelven Las Cámaras y se convocan elecciones."
            },
            {
                question: "¿Qué reforma constitucional se realizó en 1992?",
                options: ["a) Incorporación de límites al déficit presupuestario.", "b) El derecho de los europeos a votar y ser votados en las elecciones municipales (Tratado de Maastricht).", "c) La eliminación de la pena de muerte.", "d) La regulación del Tribunal Constitucional."],
                correctAnswer: "b) El derecho de los europeos a votar y ser votados en las elecciones municipales (Tratado de Maastricht)."
            },
            {
                question: "¿Qué reforma constitucional se realizó en 2011?",
                options: ["a) El derecho de sufragio pasivo de los europeos.", "b) Para asegurar el principio de estabilidad presupuestaria.", "c) La protección de las personas con discapacidad.", "d) La regulación del derecho a la huelga."],
                correctAnswer: "b) Para asegurar el principio de estabilidad presupuestaria."
            },
            {
                question: "¿Qué artículo fue reformado en 2024 en el Título I, afectando a las personas con discapacidad?",
                options: ["a) Artículo 10", "b) Artículo 14", "c) Artículo 49", "d) Artículo 55"],
                correctAnswer: "c) Artículo 49"
            },
            {
                question: "¿Quién es el Jefe del Estado, símbolo de su unidad y permanencia, según el Artículo 56 de la Constitución?",
                options: ["a) El Presidente del Gobierno.", "b) El Rey.", "c) El Presidente del Congreso.", "d) El Presidente del Tribunal Constitucional."],
                correctAnswer: "b) El Rey."
            },
            {
                question: "¿La persona del Rey de España es sujeta a responsabilidad?",
                options: ["a) Sí, siempre.", "b) No, es inviolable y no está sujeta a responsabilidad, al estar siempre sus actos refrendados.", "c) Solo en caso de delitos graves.", "d) Depende del tipo de acto que realice."],
                correctAnswer: "b) No, es inviolable y no está sujeta a responsabilidad, al estar siempre sus actos refrendados."
            },
            {
                question: "¿Quiénes son los titulares del refrendo de los actos del Rey?",
                options: ["a) Solo el Presidente del Gobierno.", "b) El Presidente del Gobierno, Ministros y Presidente del Congreso de los Diputados.", "c) El Presidente del Tribunal Supremo y el Fiscal General del Estado.", "d) Los miembros del Consejo de Estado."],
                correctAnswer: "b) El Presidente del Gobierno, Ministros y Presidente del Congreso de los Diputados." // CORREGIDA: Originalmente era 'b) El Presidente del Gobierno, Ministros y Presidente del Congreso de los Diputados.' (Ya estaba correcta, pero se asegura la explicitud).
            },
            {
                question: "¿Quién refrenda los Reales Decretos?",
                options: ["a) El Presidente del Gobierno.", "b) Los Ministros.", "c) El Presidente del Congreso de los Diputados.", "d) El Rey directamente."],
                correctAnswer: "b) Los Ministros."
            },
            {
                question: "¿Quién refrenda los casos de propuesta de candidato y nombramiento del Presidente del Gobierno y disolución de las Cortes si no se invistiese ningún candidato en dos meses?",
                options: ["a) El Presidente del Gobierno.", "b) Los Ministros.", "c) El Presidente del Congreso de los Diputados.", "d) El Fiscal General del Estado."],
                correctAnswer: "c) El Presidente del Congreso de los Diputados."
            },
            {
                question: "¿Cuál de las siguientes no es una función del Rey según el Artículo 62?",
                options: ["a) Sancionar y promulgar las leyes.", "b) Convocar y disolver las Cortes Generales.", "c) Aprobar los Presupuestos Generales del Estado.", "d) Proponer el candidato a Presidente del Gobierno."],
                correctAnswer: "c) Aprobar los Presupuestos Generales del Estado."
            },
            {
                question: "¿Quién nombra y separa a los miembros del Gobierno a propuesta de su Presidente?",
                options: ["a) Las Cortes Generales.", "b) El Rey.", "c) El Presidente del Gobierno.", "d) El Consejo de Ministros."],
                correctAnswer: "b) El Rey."
            },
            {
                question: "¿Quién ejerce el mando supremo de las Fuerzas Armadas?",
                options: ["a) El Presidente del Gobierno.", "b) El Ministro de Defensa.", "c) El Rey.", "d) El Jefe del Estado Mayor de la Defensa."],
                correctAnswer: "c) El Rey."
            },
            {
                question: "¿El Rey puede autorizar indultos generales?",
                options: ["a) Sí, siempre.", "b) Sí, con la aprobación de las Cortes Generales.", "c) No, la ley no podrá autorizar indultos generales.", "d) Sí, en casos excepcionales."],
                correctAnswer: "c) No, la ley no podrá autorizar indultos generales."
            },
            {
                question: "¿Cuándo procede la Regencia por minoría de edad del Rey?",
                options: ["a) Cuando el Rey cumple 16 años.", "b) Cuando el Rey se encuentra inhabilitado físicamente.", "c) Se encomienda al padre o madre del Rey o pariente siguiente en la sucesión.", "d) Cuando las Cortes lo designan."],
                correctAnswer: "c) Se encomienda al padre o madre del Rey o pariente siguiente en la sucesión."
            },
            {
                question: "¿Quién designa la Regencia electiva cuando no se puede la primera forma de Regencia?",
                options: ["a) El Gobierno.", "b) El Rey.", "c) Las Cortes.", "d) El Tribunal Constitucional."],
                correctAnswer: "c) Las Cortes."
            },
            {
                question: "¿Cuántas personas pueden componer la Regencia electiva?",
                options: ["a) Una o tres.", "b) Una, tres o cinco personas.", "c) Dos o cuatro.", "d) Solo una."],
                correctAnswer: "b) Una, tres o cinco personas."
            },
            {
                question: "¿Con qué poderes se ejerce siempre la Regencia?",
                options: ["a) Con los poderes que le atribuye el Presidente del Gobierno.", "b) Con los mismos poderes que al Rey encomienda la Constitución.", "c) Con poderes limitados por la ley.", "d) Con los poderes que determinen las Cortes."],
                correctAnswer: "b) Con los mismos poderes que al Rey encomienda la Constitución."
            },
            {
                question: "¿En nombre de quién se ejerce siempre la Regencia?",
                options: ["a) En nombre del pueblo español.", "b) En nombre de las Cortes Generales.", "c) En nombre del Rey.", "d) En nombre del Gobierno."],
                correctAnswer: "c) En nombre del Rey."
            },
            {
                question: "¿Es posible la revocación de un Regente legítimo?",
                options: ["a) Sí, siempre.", "b) Sí, por acuerdo de las Cortes.", "c) No, por ser una previsión constitucional.", "d) Solo en caso de incapacidad."],
                correctAnswer: "c) No, por ser una previsión constitucional."
            },
            {
                question: "¿Quién será el tutor del Rey menor si no lo hubiese nombrado el Rey difunto en su testamento?",
                options: ["a) Las Cortes.", "b) El Presidente del Gobierno.", "c) El padre o la madre mientras permanezcan viudos.", "d) Un miembro de la Casa Real."],
                correctAnswer: "c) El padre o la madre mientras permanezcan viudos."
            },
            {
                question: "¿Qué es incompatible con el ejercicio de la tutela del Rey menor?",
                options: ["a) El ejercicio de cualquier profesión.", "b) El de todo cargo o representación política.", "c) La pertenencia a un partido político.", "d) La residencia fuera de España."],
                correctAnswer: "b) El de todo cargo o representación política." // CORREGIDA: Originalmente era 'b) El de todo cargo o representación política.' (Ya estaba correcta, pero se asegura la explicitud).
            },
            {
                question: "Según la tabla de protección judicial, ¿qué nivel de protección corresponde al Artículo 14 (Igualdad ante la Ley)?",
                options: ["a) Nivel alto", "b) Nivel medio", "c) Nivel bajo", "d) Ninguno"],
                correctAnswer: "a) Nivel alto"
            },
            {
                question: "¿Qué recurso se asocia con el Nivel ALTO de protección judicial de los derechos fundamentales y libertades públicas?",
                options: ["a) Recurso de inconstitucionalidad.", "b) Recurso contencioso-administrativo.", "c) Recurso de amparo.", "d) Recurso de revisión."],
                correctAnswer: "c) Recurso de amparo."
            },
            {
                question: "¿Qué principio rige el procedimiento de tutela de las libertades y derechos de Nivel ALTO?",
                options: ["a) Principio de celeridad.", "b) Principio de oralidad.", "c) Principios de preferencia y sumariedad.", "d) Principio de contradicción."],
                correctAnswer: "c) Principios de preferencia y sumariedad."
            },
            {
                question: "¿Cómo se desarrolla normativamente el Artículo 14 de la Constitución (Igualdad ante la ley)?",
                options: ["a) Por Ley Orgánica.", "b) Por Ley.", "c) Por Real Decreto.", "d) Por Reglamento."],
                correctAnswer: "b) Por Ley."
            },
            {
                question: "¿Qué tipo de Ley se requiere para regular el ejercicio de los derechos y libertades de la Sección Primera del Capítulo II del Título I?",
                options: ["a) Ley ordinaria.", "b) Ley Orgánica.", "c) Decreto Legislativo.", "d) Orden Ministerial."],
                correctAnswer: "b) Ley Orgánica."
            },
            {
                question: "¿Qué nivel de protección corresponde al Capítulo III del Título I (Principios rectores de la política social y económica)?",
                options: ["a) Nivel alto", "b) Nivel medio", "c) Nivel bajo", "d) Nivel superior"],
                correctAnswer: "c) Nivel bajo"
            },
            {
                question: "¿Qué mecanismo asegura el restablecimiento de la normalidad de los poderes en una sociedad democrática en casos de grave riesgo, catástrofe, calamidades o desgracias públicas?",
                options: ["a) Estado de excepción.", "b) Estado de sitio.", "c) Estado de alarma.", "d) Movilización general."],
                correctAnswer: "c) Estado de alarma."
            },
            {
                question: "¿Quién declara el estado de alarma?",
                options: ["a) El Congreso de los Diputados.", "b) El Gobierno mediante decreto acordado en Consejo de Ministros.", "c) El Rey a propuesta del Gobierno.", "d) El Tribunal Constitucional."],
                correctAnswer: "b) El Gobierno mediante decreto acordado en Consejo de Ministros."
            },
            {
                question: "¿Cuál es la duración máxima del estado de alarma?",
                options: ["a) 30 días.", "b) 60 días.", "c) 15 días.", "d) No tiene límite de tiempo."],
                correctAnswer: "c) 15 días."
            },
            {
                question: "¿En qué estado se puede declarar un régimen de excepción, durante el cual se suspende el libre ejercicio de algunos derechos por parte de los ciudadanos?",
                options: ["a) Estado de alarma.", "b) Estado de excepción.", "c) Estado de sitio.", "d) Estado de emergencia."],
                correctAnswer: "b) Estado de excepción."
            },
            {
                question: "¿Quién autoriza la declaración del estado de excepción?",
                options: ["a) El Gobierno mediante decreto.", "b) El Congreso de los Diputados por mayoría absoluta a propuesta exclusiva del Gobierno.", "c) El Rey.", "d) El Tribunal Supremo."],
                correctAnswer: "b) El Congreso de los Diputados por mayoría absoluta a propuesta exclusiva del Gobierno."
            },
            {
                question: "¿Cuál es la duración máxima del estado de excepción?",
                options: ["a) 15 días.", "b) 30 días.", "c) 60 días.", "d) No tiene límite de tiempo."],
                correctAnswer: "b) 30 días."
            },
            {
                question: "¿En qué estado el control del orden interno pasa a ser controlado por las Fuerzas Armadas?",
                options: ["a) Estado de alarma.", "b) Estado de excepción.", "c) Estado de sitio.", "d) Estado de emergencia."],
                correctAnswer: "c) Estado de sitio."
            },
            {
                question: "En el estado de sitio, ¿qué artículo puede ser suspendido además de los que se suspenden en el estado de excepción?",
                options: ["a) Artículo 18.2 (Inviolabilidad del domicilio).", "b) Artículo 20.1 a) (Libertad de expresión).", "c) Artículo 17.3 (Información al detenido y asistencia de abogado).", "d) Artículo 21 (Derecho de reunión)."],
                correctAnswer: "c) Artículo 17.3 (Información al detenido y asistencia de abogado)."
            }
        ];

               // Variables de estado del quiz
        let currentQuestionIndex = 0;
        let score = 0;
        // userAnswers guarda el texto de la opción seleccionada (o null)
        // Corregido: Usar questions.length en lugar de questions.length
        const userAnswers = new Array(questions.length).fill(null);
        // scoredQuestions guarda true si la pregunta fue respondida correctamente, false si fue incorrecta o no respondida
        // Corregido: Usar questions.length en lugar de questions.length
        const scoredQuestions = new Array(questions.length).fill(false); 

        // Referencias a los elementos del DOM
        const quizContainer = document.getElementById('quizContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const restartBtn = document.getElementById('restartBtn');
        const restartInlineBtn = document.getElementById('restartInlineBtn');
        const finalScoreDiv = document.getElementById('finalScore');
        const progressBar = document.getElementById('progressBar');
        const finalScoreDisplay = finalScoreDiv.querySelector('.score-display');
        const correctCountSpan = document.getElementById('correctCount');
        const incorrectCountSpan = document.getElementById('incorrectCount');
        const unansweredCountSpan = document.getElementById('unansweredCount');

        /**
         * Carga el estado del quiz guardado en localStorage.
         * Si no existe, inicializa un nuevo estado.
         */
        function loadQuizState() {
            try {
                const savedState = JSON.parse(localStorage.getItem('quizState'));
                if (savedState) {
                    currentQuestionIndex = savedState.currentQuestionIndex;
                    score = savedState.score;
                    // Asegurarse de que los arrays tengan el tamaño correcto y copiar los valores
                    userAnswers.splice(0, savedState.userAnswers.length, ...savedState.userAnswers);
                    scoredQuestions.splice(0, savedState.scoredQuestions.length, ...savedState.scoredQuestions);
                }
            } catch (e) {
                console.error("Error al cargar el estado del quiz:", e);
                // Si hay un error, el estado se reiniciará a los valores por defecto
            }
        }

        /**
         * Guarda el estado actual del quiz en localStorage.
         */
        function saveQuizState() {
            const quizState = {
                currentQuestionIndex: currentQuestionIndex,
                score: score,
                userAnswers: userAnswers,
                scoredQuestions: scoredQuestions
            };
            localStorage.setItem('quizState', JSON.stringify(quizState));
        }

        /**
         * Carga y muestra la pregunta actual.
         */
        function loadQuestion() {
            // Corregido: Usar questions.length en lugar de questions.length
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            // Corregido: Usar questions en lugar de questions
            const currentQuestion = questions[currentQuestionIndex];
            quizContainer.innerHTML = `
                <div class="question-card">
                    <p class="question-text"></p>
                    <div class="options-container">
                        ${currentQuestion.options.map(() => `
                            <button class="option-button"></button>
                        `).join('')}
                    </div>
                    <div class="solution hidden">
                        <strong>Solución:</strong> <span class="solution-text"></span>
                    </div>
                </div>
            `;

            const questionTextElement = quizContainer.querySelector('.question-text');
            const optionsContainer = quizContainer.querySelector('.options-container');
            const questionCard = quizContainer.querySelector('.question-card');
            const optionButtons = optionsContainer.querySelectorAll('.option-button');

            // Usar textContent para insertar el texto de la pregunta de forma segura
            questionTextElement.textContent = `${currentQuestionIndex + 1}. ${currentQuestion.question}`;

            // Asignar el texto y los atributos data-option a cada botón de opción
            currentQuestion.options.forEach((option, index) => {
                optionButtons[index].textContent = option; // Inserta el texto como texto plano
                optionButtons[index].dataset.option = option; // Guarda la opción original para la lógica
                optionButtons[index].addEventListener('click', handleOptionClick);
            });

            // Resalta la respuesta del usuario si ya ha respondido y aplica estilos
            const savedAnswer = userAnswers[currentQuestionIndex];
            if (savedAnswer !== null) {
                // Encuentra el botón por su atributo data-option, que contiene la respuesta guardada
                const selectedButton = optionsContainer.querySelector(`[data-option="${savedAnswer}"]`);
                if (selectedButton) {
                    // Deshabilita todos los botones para que no se pueda cambiar la respuesta
                    optionButtons.forEach(button => {
                        button.classList.add('disabled');
                        button.removeEventListener('click', handleOptionClick); // Remover listener si ya está respondida
                    });

                    // Aplica los estilos de la respuesta guardada
                    const isCorrect = (savedAnswer === currentQuestion.correctAnswer);
                    if (isCorrect) {
                        selectedButton.classList.add('correct-answer');
                        questionCard.classList.add('correct');
                    } else {
                        selectedButton.classList.add('incorrect-answer');
                        questionCard.classList.add('incorrect');
                        // Muestra la respuesta correcta si la guardada fue incorrecta
                        const correctButton = optionsContainer.querySelector(`[data-option="${currentQuestion.correctAnswer}"]`);
                        if (correctButton) {
                            correctButton.classList.add('correct-answer');
                        }
                    }
                    // Añadir feedback visual (Correcto/Incorrecto)
                    updateQuestionCardVisuals(isCorrect);
                }
            }

            // Actualiza el estado de los botones de navegación y la barra de progreso
            updateNavButtons();
            updateProgressBar();
        }

        /**
         * Maneja el evento de clic en una opción de respuesta.
         * @param {Event} event - El evento de clic.
         */
        function handleOptionClick(event) {
            const selectedOptionButton = event.target;
            const selectedOption = selectedOptionButton.dataset.option; // Obtiene la opción del atributo data-option
            // Corregido: Usar questions en lugar de questions
            const currentQuestion = questions[currentQuestionIndex];
            const optionsContainer = quizContainer.querySelector('.options-container');
            const questionCard = quizContainer.querySelector('.question-card');

            // Deshabilita todos los botones de opción para evitar múltiples respuestas
            optionsContainer.querySelectorAll('.option-button').forEach(button => {
                button.classList.add('disabled');
                button.removeEventListener('click', handleOptionClick);
            });

            // Actualiza la respuesta del usuario y la guarda
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // Comprueba si la respuesta es correcta
            const isCorrectAttempt = (selectedOption === currentQuestion.correctAnswer);

            if (isCorrectAttempt) {
                selectedOptionButton.classList.add('correct-answer');
                questionCard.classList.add('correct');
                // Si no se ha puntuado antes, añade un punto y marca como correcta
                if (!scoredQuestions[currentQuestionIndex]) { // scoredQuestions[index] will be false if not yet scored
                    score++;
                    scoredQuestions[currentQuestionIndex] = true; // Marca como correcta
                }
            } else {
                selectedOptionButton.classList.add('incorrect-answer');
                questionCard.classList.add('incorrect');
                // Si se había puntuado como correcta (porque el usuario cambió de opinión), quita el punto
                if (scoredQuestions[currentQuestionIndex]) { // scoredQuestions[index] will be true if it was previously correct
                    score--;
                    scoredQuestions[currentQuestionIndex] = false; // Marca como incorrecta
                }
                // Resalta la respuesta correcta
                const correctAnswerButton = optionsContainer.querySelector(`[data-option="${currentQuestion.correctAnswer}"]`);
                if (correctAnswerButton) {
                    correctAnswerButton.classList.add('correct-answer');
                }
            }
            
            saveQuizState(); // Guarda el estado después de actualizar score y scoredQuestions

            // Añadir feedback visual (Correcto/Incorrecto)
            updateQuestionCardVisuals(isCorrectAttempt);

            // Muestra la solución detallada si existe (aunque no hay en tu questions actual)
            if (currentQuestion.solution) {
                const solutionDiv = quizContainer.querySelector('.solution');
                solutionDiv.classList.remove('hidden');
                solutionDiv.querySelector('.solution-text').textContent = currentQuestion.solution;
            }
        }

        /**
         * Actualiza el estilo de la tarjeta de pregunta y añade feedback visual.
         * @param {boolean} isCorrect - Indica si la respuesta es correcta.
         */
        function updateQuestionCardVisuals(isCorrect) {
            const questionCard = document.querySelector('.question-card');
            // Eliminar feedback anterior si existe
            const existingFeedback = questionCard.querySelector('.feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }

            const feedbackMessage = document.createElement('p');
            feedbackMessage.classList.add('feedback');

            if (isCorrect) {
                feedbackMessage.textContent = '¡Correcto!';
                feedbackMessage.classList.add('correct');
            } else {
                feedbackMessage.textContent = 'Incorrecto. La respuesta correcta es la marcada en verde.';
                feedbackMessage.classList.add('incorrect');
            }
            questionCard.appendChild(feedbackMessage);
        }

        /**
         * Muestra los resultados finales del quiz.
         */
        function showResults() {
            quizContainer.classList.add('hidden');
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            restartInlineBtn.classList.add('hidden');
            progressBar.parentElement.classList.add('hidden');
            finalScoreDiv.classList.remove('hidden');

            // Calcula y muestra las estadísticas
            const correctAnswers = scoredQuestions.filter(isCorrect => isCorrect).length;
            // Una respuesta es incorrecta si el usuario respondió (no es null) Y no fue marcada como correcta (scoredQuestions[index] es false)
            const incorrectAnswers = userAnswers.filter((answer, index) => answer !== null && !scoredQuestions[index]).length;
            const unansweredQuestions = userAnswers.filter(answer => answer === null).length;

            // Corregido: Usar questions.length en lugar de questions.length
            finalScoreDisplay.textContent = `Tu puntuación final es ${correctAnswers} de ${questions.length}`;
            correctCountSpan.textContent = correctAnswers;
            incorrectCountSpan.textContent = incorrectAnswers;
            unansweredCountSpan.textContent = unansweredQuestions;
        }
		
        /**
         * Actualiza el estado de los botones de navegación.
         */
        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            // Corregido: Usar questions.length en lugar de questions.length
            nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? 'Finalizar' : 'Siguiente';
        }

        /**
         * Actualiza la barra de progreso.
         */
        function updateProgressBar() {
            // Corregido: Usar questions.length en lugar de questions.length
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        /**
         * Reinicia el quiz a su estado inicial.
         */
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers.fill(null);
            scoredQuestions.fill(false);
            localStorage.clear(); // Limpia el localStorage
            
            quizContainer.classList.remove('hidden');
            prevBtn.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            restartInlineBtn.classList.remove('hidden');
            progressBar.parentElement.classList.remove('hidden');
            finalScoreDiv.classList.add('hidden');
            loadQuestion();
        }

        // Event listeners
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        });

        nextBtn.addEventListener('click', () => {
            // Corregido: Usar questions.length en lugar de questions.length
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        });

        restartBtn.addEventListener('click', restartQuiz);
        restartInlineBtn.addEventListener('click', restartQuiz);

        // Carga inicial
        window.onload = function() {
            loadQuizState();
            loadQuestion();
        };
    </script>
</body>
</html>


