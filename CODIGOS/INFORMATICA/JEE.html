<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE</title>
    <!-- Enlace a Tailwind CSS para las clases de la estructura HTML -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS completo para el estilo del quiz -->
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Contenedor principal del quiz */
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
        }

        /* Tarjeta de la pregunta */
        .question-card {
            background-color: #f8fafc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease-in-out;
        }

        /* Estilo para la tarjeta de pregunta correcta */
        .question-card.correct {
            background-color: #d4edda;
            border-color: #28a745;
        }

        /* Estilo para la tarjeta de pregunta incorrecta */
        .question-card.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }

        /* Texto de la pregunta */
        .question-text {
            font-size: 1.15rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* Botones de opciones */
        .option-button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 18px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            background-color: #ffffff;
            color: #4a5568;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Efecto hover para los botones de opciones */
        .option-button:hover:not(.disabled) {
            background-color: #e2e8f0;
            border-color: #a0aec0;
        }

        /* Estilo para el botón de opción seleccionado */
        .option-button.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
            font-weight: 600;
        }

        /* Estilo para la respuesta correcta */
        .option-button.correct-answer {
            background-color: #28a745;
            color: #ffffff;
            border-color: #28a745;
            font-weight: 700;
        }

        /* Estilo para la respuesta incorrecta */
        .option-button.incorrect-answer {
            background-color: #dc3545;
            color: #ffffff;
            border-color: #dc3545;
            font-weight: 700;
        }

        /* Estilo para los botones deshabilitados */
        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Contenedor de la solución */
        .solution {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #e0f2f7;
            color: #2c5282;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid #90cdf4;
        }

        /* Contenedor del feedback (correcto/incorrecto) */
        .feedback {
            margin-top: 15px;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
        }

        /* Estilo para feedback correcto */
        .feedback.correct {
            color: #28a745;
        }

        /* Estilo para feedback incorrecto */
        .feedback.incorrect {
            color: #dc3545;
        }

        /* Contenedor de los botones de navegación */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Estilo base para los botones de navegación */
        .nav-button {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            text-align: center;
        }

        /* Estilo para el botón "Anterior" */
        .nav-button.prev {
            background-color: #6b7280;
            color: #ffffff;
        }
        .nav-button.prev:hover:not(:disabled) {
            background-color: #4b5563;
            transform: translateY(-2px);
        }

        /* Estilo para el botón "Siguiente" */
        .nav-button.next {
            background-color: #4299e1;
            color: #ffffff;
        }
        .nav-button.next:hover:not(:disabled) {
            background-color: #3182ce;
            transform: translateY(-2px);
        }

        /* Estilo para el botón de reinicio en línea */
        .nav-button.restart-inline {
            background-color: #f50b0b;
            color: #ffffff;
        }
        .nav-button.restart-inline:hover:not(:disabled) {
            background-color: #ac0505;
            transform: translateY(-2px);
        }

        /* Estilo para los botones deshabilitados */
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Barra de progreso */
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 5px;
            height: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #4299e1;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        /* Visualización de la puntuación final */
        .score-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-top: 20px;
        }

        /* Resumen de resultados */
        .results-summary {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .results-summary p {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .results-summary p strong {
            font-weight: 700;
        }

        /* Botón de reinicio final */
        .restart-button {
            display: block;
            width: fit-content;
            margin: 20px auto 0 auto;
            padding: 12px 30px;
            background-color: #48bb78;
            color: #ffffff;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .restart-button:hover {
            background-color: #38a169;
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
         <h1 style="color: #003366; font-family: 'Georgia', serif; font-size: 3rem; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">JEE</h1>

        <!-- Barra de progreso -->
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <!-- Contenedor principal de las preguntas -->
        <div id="quizContainer">
            <!-- Las preguntas se cargarán dinámicamente aquí -->
        </div>

        <!-- Botones de navegación -->
        <div class="navigation-buttons">
            <button id="prevBtn" class="nav-button prev" disabled>Anterior</button>
            <button id="restartInlineBtn" class="nav-button restart-inline">Reiniciar Test</button>
            <button id="nextBtn" class="nav-button next">Siguiente</button>
        </div>

        <!-- Contenedor de la puntuación final -->
        <div id="finalScore" class="hidden">
            <div class="score-display"></div>
            <div class="results-summary">
                <p><strong>Preguntas Correctas:</strong> <span id="correctCount">0</span></p>
                <p><strong>Preguntas Incorrectas:</strong> <span id="incorrectCount">0</span></p>
                <p><strong>Preguntas Sin Contestar:</strong> <span id="unansweredCount">0</span></p>
            </div>
            <button id="restartBtn" class="restart-button">Reiniciar Test</button>
        </div>
    </div>

    <script>
        const quizData = [
            {
                question: "¿Qué fundación gestiona actualmente Jakarta EE?",
                options: [
                    "a) Sun Microsystems",
                    "b) Oracle",
                    "c) The Eclipse Foundation",
                    "d) Apache Software Foundation"
                ],
                correctAnswer: "c) The Eclipse Foundation"
            },
            {
                question: "¿Cuál de los siguientes es el perfil completo de Jakarta EE 10?",
                options: [
                    "a) Jakarta EE Web Profile",
                    "b) Jakarta EE Core Profile",
                    "c) Jakarta EE Platform",
                    "d) MicroProfile"
                ],
                correctAnswer: "c) Jakarta EE Platform"
            },
            {
                question: "¿Qué afirmación es correcta respecto a Jakarta EE Core Profile?",
                options: [
                    "a) Es el producto completo de Jakarta EE.",
                    "b) Es un subconjunto más ligero que incluye Servlets.",
                    "c) Es el subconjunto más ligero, no incluye Servlet pero sí REST.",
                    "d) Incluye todas las APIs de MicroProfile 6."
                ],
                correctAnswer: "c) Es el subconjunto más ligero, no incluye Servlet pero sí REST."
            },
            {
                question: "El cambio de J2EE a JEE implicó una modificación en los paquetes. ¿Cuál fue el cambio?",
                options: [
                    "a) De org.java.* a com.java.*",
                    "b) De java.* a javax.*",
                    "c) De javax.* a jakarta.*",
                    "d) De com.sun.* a org.eclipse.*"
                ],
                correctAnswer: "c) De javax.* a jakarta.*"
            },
            {
                question: "¿Qué es MicroProfile?",
                options: [
                    "a) Un subconjunto de Jakarta EE Platform.",
                    "b) Un conjunto de APIs para microservicios.",
                    "c) El proceso de especificación de Jakarta EE.",
                    "d) Un gestor de transacciones distribuidas."
                ],
                correctAnswer: "b) Un conjunto de APIs para microservicios."
            },
            {
                question: "¿Qué tipo de APIs definen los componentes de una aplicación JEE que son programados por el desarrollador?",
                options: [
                    "a) APIs de servicios ofrecidos por el App Server.",
                    "b) APIs que gestionan transacciones distribuidas.",
                    "c) APIs de la capa de presentación y la capa de negocio.",
                    "d) APIs para la gestión de colas de mensajes del App Server."
                ],
                correctAnswer: "c) APIs de la capa de presentación y la capa de negocio."
            },
            {
                question: "En la arquitectura JEE, ¿dónde se ubican los componentes de la capa de presentación?",
                options: [
                    "a) En el EJB Container",
                    "b) En el Web Container",
                    "c) En el App Server",
                    "d) En el motor de Web Services"
                ],
                correctAnswer: "b) En el Web Container"
            },
            {
                question: "Un JSP combina HTML con código Java. ¿Cómo se inserta el código Java en un JSP?",
                options: [
                    "a) Mediante tags <java>",
                    "b) Con $<% código java %>",
                    "c) Utilizando etiquetas personalizadas de JSTL",
                    "d) Con la sintaxis html+<\\%$ código java %> + objetos predefinidos"
                ],
                correctAnswer: "d) Con la sintaxis html+<\\%$ código java %> + objetos predefinidos"
            },
            {
                question: "¿Cuál es la principal ventaja de JSTL sobre el uso directo de scriptlets Java en un JSP?",
                options: [
                    "a) Permite el uso de JavaScript.",
                    "b) Facilita el acceso a la base de datos directamente.",
                    "c) Permite sacar el código Java de la página HTML mediante etiquetas personalizadas.",
                    "d) Optimiza el rendimiento del Web Container."
                ],
                correctAnswer: "c) Permite sacar el código Java de la página HTML mediante etiquetas personalizadas."
            },
            {
                question: "¿Qué componentes en la capa de presentación reciben las peticiones HTTP y canalizan el flujo del programa?",
                options: [
                    "a) JSF",
                    "b) JSTL",
                    "c) Servlets / Filter",
                    "d) EJB Session"
                ],
                correctAnswer: "c) Servlets / Filter"
            },
            {
                question: "¿Cuál es el propósito fundamental de los EJB Session?",
                options: [
                    "a) Gestionar colas de mensajes.",
                    "b) Implementar la lógica de negocio.",
                    "c) Ofrecer servicios de persistencia de alto nivel.",
                    "d) Gestionar transacciones distribuidas."
                ],
                correctAnswer: "b) Implementar la lógica de negocio."
            },
            {
                question: "¿Qué característica distingue a los EJB Session con estado?",
                options: [
                    "a) Son clases sin atributos.",
                    "b) Guardan información entre llamadas.",
                    "c) Son componentes transaccionales, pero no garantizan el commit.",
                    "d) Su lógica de negocio es asíncrona."
                ],
                correctAnswer: "b) Guardan información entre llamadas."
            },
            {
                question: "Respecto a los EJB Session, ¿qué significa que sean componentes transaccionales?",
                options: [
                    "a) Que implementan la lógica de negocio basada en transacciones bancarias.",
                    "b) Que el commit y el rollback están garantizados y ya implementados.",
                    "c) Que solo pueden acceder a una base de datos a la vez.",
                    "d) Que no pueden participar en transacciones distribuidas."
                ],
                correctAnswer: "b) Que el commit y el rollback están garantizados y ya implementados."
            },
            {
                question: "¿Qué tipo de EJB se utiliza para implementar lógica de negocio asíncrona y actúa como gestor de colas?",
                options: [
                    "a) EJB Session Stateless",
                    "b) EJB Session Stateful",
                    "c) EJB Message Driven Bean (MDB)",
                    "d) EJB Singleton"
                ],
                correctAnswer: "c) EJB Message Driven Bean (MDB)"
            },
            {
                question: "¿Cómo se comunican JMS y EJB MDB para procesar mensajes?",
                options: [
                    "a) JMS llama directamente al EJB MDB.",
                    "b) El EJB MDB envía mensajes a la cola JMS.",
                    "c) JMS manda el mensaje a la cola, y el EJB MDB recibe el mensaje de la cola.",
                    "d) Ambos se comunican a través de un Web Service REST."
                ],
                correctAnswer: "c) JMS manda el mensaje a la cola, y el EJB MDB recibe el mensaje de la cola."
            },
            {
                question: "¿Qué servicio de JEE se encarga de las transacciones distribuidas y utiliza el protocolo two-phase commit?",
                options: [
                    "a) JNDI",
                    "b) JMS",
                    "c) JTA",
                    "d) JPA"
                ],
                correctAnswer: "c) JTA"
            },
            {
                question: "¿Qué es JNDI en la arquitectura JEE?",
                options: [
                    "a) Un servicio de persistencia de bajo nivel.",
                    "b) Un servicio de colas de mensajes.",
                    "c) Un servicio de nombres, similar a un árbol de objetos.",
                    "d) Un motor de Web Services."
                ],
                correctAnswer: "c) Un servicio de nombres, similar a un árbol de objetos."
            },
            {
                question: "En el contexto de JNDI, ¿quién es el responsable de crear y registrar los objetos en el árbol de nombres?",
                options: [
                    "a) El desarrollador.",
                    "b) El cliente.",
                    "c) El servidor de aplicaciones.",
                    "d) La base de datos."
                ],
                correctAnswer: "c) El servidor de aplicaciones."
            },
            {
                question: "¿Cuál es el servicio de persistencia de alto nivel en JEE que funciona como un ORM (Object-Relational Mapping)?",
                options: [
                    "a) JDBC",
                    "b) JMS",
                    "c) JPA",
                    "d) JSON-P"
                ],
                correctAnswer: "c) JPA"
            },
            {
                question: "¿Qué API se utiliza para Web Services SOAP en JEE?",
                options: [
                    "a) JAX-RS",
                    "b) JSON-P",
                    "c) JAX-WS",
                    "d) CDI"
                ],
                correctAnswer: "c) JAX-WS"
            },
            {
                question: "¿Qué API se utiliza para Web Services REST en JEE?",
                options: [
                    "a) JAX-WS",
                    "b) JAX-RS",
                    "c) JMS",
                    "d) JTA"
                ],
                correctAnswer: "b) JAX-RS"
            },
            {
                question: "¿Qué significa CDI en el contexto de JEE?",
                options: [
                    "a) Conectores y Distribuidores de Información.",
                    "b) Contextos y Dependencia de Inyección.",
                    "c) Componentes de Interfaz de Usuario.",
                    "d) Configuración de Dispositivos Integrados."
                ],
                correctAnswer: "b) Contextos y Dependencia de Inyección."
            },
            {
                question: "¿Cuál de los siguientes es un producto compatible con JEE?",
                options: [
                    "a) Apache Hadoop",
                    "b) Node.js",
                    "c) Eclipse Glassfish",
                    "d) Ruby on Rails"
                ],
                correctAnswer: "c) Eclipse Glassfish"
            },
            {
                question: "¿Qué componente del servidor de aplicaciones tiene la lógica para entender el mundo HTTP y llamar al código Java?",
                options: [
                    "a) EJB Container",
                    "b) Web Container",
                    "c) JMS Server",
                    "d) JTA Monitor"
                ],
                correctAnswer: "b) Web Container"
            },
            {
                question: "¿Cuál es el papel de un Filter en la cadena de responsabilidades en una aplicación web JEE?",
                options: [
                    "a) Recibir peticiones HTTP y canalizar el flujo del programa.",
                    "b) Implementar la lógica de negocio asíncrona.",
                    "c) Realizar acciones horizontales como compresión, codificación o validación.",
                    "d) Definir los componentes de la aplicación."
                ],
                correctAnswer: "c) Realizar acciones horizontales como compresión, codificación o validación."
            },
            {
                question: "¿Puede un filtro cortar o cambiar el flujo de ejecución?",
                options: [
                    "a) No, solo pueden realizar transformaciones.",
                    "b) Sí, por ejemplo, si no pasa ciertas validaciones.",
                    "c) Solo si no hay un Servlet asociado.",
                    "d) Únicamente si se configura como un punto de acceso directo."
                ],
                correctAnswer: "b) Sí, por ejemplo, si no pasa ciertas validaciones."
            },
            {
                question: "En el contexto de los servicios JEE, ¿quién es el responsable de crear los objetos principales como UserTransaction o InitialContext?",
                options: [
                    "a) El desarrollador",
                    "b) El cliente",
                    "c) El app server",
                    "d) El sistema operativo"
                ],
                correctAnswer: "c) El app server"
            },
            {
                question: "¿Qué método del objeto UserTransaction (relacionado con JTA) se utiliza para finalizar una transacción exitosa?",
                options: [
                    "a) start()",
                    "b) rollback()",
                    "c) begin()",
                    "d) commit()"
                ],
                correctAnswer: "d) commit()"
            },
            {
                question: "¿Qué método del objeto InitialContext (relacionado con JNDI) se utiliza para buscar objetos en el árbol de nombres?",
                options: [
                    "a) bind()",
                    "b) rebind()",
                    "c) lookup(String)",
                    "d) unbind()"
                ],
                correctAnswer: "c) lookup(String)"
            },
            {
                question: "¿Qué tipo de objetos se pueden encontrar en el árbol JNDI?",
                options: [
                    "a) Solo bases de datos.",
                    "b) Objetos para mails, colas de mensajes, JTA, Data Sources, EJBs.",
                    "c) Únicamente componentes de la capa de presentación.",
                    "d) Exclusivamente objetos de sesión HTTP."
                ],
                correctAnswer: "b) Objetos para mails, colas de mensajes, JTA, Data Sources, EJBs."
            },
            {
                question: "En JDBC, ¿qué tipo de Statement se utiliza para ejecutar SQL precompilado y prevenir SQL Injection?",
                options: [
                    "a) Statement",
                    "b) CallableStatement",
                    "c) PreparedStatement",
                    "d) ResultSet"
                ],
                correctAnswer: "c) PreparedStatement"
            },
            {
                question: "¿Qué interfaz en JMS define el método onMessage(Message) para el procesamiento de mensajes?",
                options: [
                    "a) Queue",
                    "b) Topic",
                    "c) MessageListener",
                    "d) ConnectionFactory"
                ],
                correctAnswer: "c) MessageListener"
            },
            {
                question: "En JMS, ¿cuál es la principal diferencia entre Queue y Topic?",
                options: [
                    "a) Queue es para comunicación síncrona, Topic para asíncrona.",
                    "b) Queue permite multidifusión (1:N), Topic no (1:1).",
                    "c) Queue es 1:1 (un consumidor), Topic es 1:N (varios consumidores).",
                    "d) Queue solo recibe mensajes de texto, Topic cualquier tipo de mensaje."
                ],
                correctAnswer: "c) Queue es 1:1 (un consumidor), Topic es 1:N (varios consumidores)."
            },
            {
                question: "¿Qué método del EntityManager (JPA) se utiliza para almacenar nuevas entidades en la base de datos?",
                options: [
                    "a) find()",
                    "b) merge()",
                    "c) remove()",
                    "d) persist()"
                ],
                correctAnswer: "d) persist()"
            },
            {
                question: "¿Qué anotación JPA se utiliza para identificar una clase como una 'entidad' persistente?",
                options: [
                    "a) @Table",
                    "b) @Column",
                    "c) @Entity",
                    "d) @Id"
                ],
                correctAnswer: "c) @Entity"
            },
            {
                question: "¿Qué anotación JPA se utiliza para especificar la clave primaria de una entidad?",
                options: [
                    "a) @Column",
                    "b) @Id",
                    "c) @GeneratedValue",
                    "d) @Transient"
                ],
                correctAnswer: "b) @Id"
            },
            {
                question: "En JAX-WS, ¿qué anotación se utiliza para marcar una clase como un servicio web?",
                options: [
                    "a) @WebMethod",
                    "b) @WebParam",
                    "c) @WebService",
                    "d) @Path"
                ],
                correctAnswer: "c) @WebService"
            },
            {
                question: "En JAX-RS, ¿qué anotación se utiliza para definir el camino (path) de un recurso REST?",
                options: [
                    "a) @GET",
                    "b) @POST",
                    "c) @Path",
                    "d) @Produces"
                ],
                correctAnswer: "c) @Path"
            },
            {
                question: "¿Qué anotación de CDI se utiliza para inyectar una dependencia?",
                options: [
                    "a) @Named",
                    "b) @RequestScoped",
                    "c) @Inject",
                    "d) @Stateless"
                ],
                correctAnswer: "c) @Inject"
            },
            {
                question: "¿Cómo se conoce también al Servlet por su patrón de diseño en el que canaliza una URL de petición/negocio al resto de capas?",
                options: [
                    "a) Patrón Observer",
                    "b) Patrón Singleton",
                    "c) Patrón Front Controller",
                    "d) Patrón Factory"
                ],
                correctAnswer: "c) Patrón Front Controller"
            },
            {
                question: "¿Quién es el responsable de invocar un Servlet?",
                options: [
                    "a) El cliente web",
                    "b) El desarrollador",
                    "c) El app server",
                    "d) La base de datos"
                ],
                correctAnswer: "c) El app server"
            },
            {
                question: "¿Qué método de un Servlet se llama una única vez cuando se carga el Servlet por primera vez?",
                options: [
                    "a) service()",
                    "b) doGet()",
                    "c) init()",
                    "d) destroy()"
                ],
                correctAnswer: "c) init()"
            },
            {
                question: "¿Qué método de un Servlet se llama por cada petición HTTP, y a su vez puede delegar en métodos como doGet() o doPost()?",
                options: [
                    "a) init()",
                    "b) destroy()",
                    "c) service()",
                    "d) getParameter()"
                ],
                correctAnswer: "c) service()"
            },
            {
                question: "¿Por qué ServletRequest y ServletResponse fueron inicialmente diseñados como interfaces separadas de HttpServletRequest y HttpServletResponse?",
                options: [
                    "a) Para permitir diferentes protocolos además de HTTP.",
                    "b) Para optimizar el rendimiento.",
                    "c) Para facilitar la implementación de filtros.",
                    "d) Para asegurar la seguridad de la aplicación."
                ],
                correctAnswer: "a) Para permitir diferentes protocolos además de HTTP."
            },
            {
                question: "¿Qué método de ServletRequest se utiliza para obtener parámetros de una URL, como los que van después del signo de interrogación?",
                options: [
                    "a) getAttribute()",
                    "b) getHeader()",
                    "c) getParameter(String)",
                    "d) getInputStream()"
                ],
                correctAnswer: "c) getParameter(String)"
            },
            {
                question: "¿Dónde se mapea tradicionalmente la clase de un Servlet con su URL de servicio en una aplicación web JEE?",
                options: [
                    "a) En el archivo pom.xml",
                    "b) En el archivo web.xml",
                    "c) En el archivo persistence.xml",
                    "d) En el código fuente del Servlet"
                ],
                correctAnswer: "b) En el archivo web.xml"
            },
            {
                question: "¿Qué alternativa existe a la configuración de Servlets en web.xml para mapear una URL?",
                options: [
                    "a) Uso de JSTL.",
                    "b) Anotaciones como @WebServlet(\"url\").",
                    "c) Configuración a través de un EJB.",
                    "d) Directamente en el fichero index.html."
                ],
                correctAnswer: "b) Anotaciones como @WebServlet(\"url\")."
            },
            {
                question: "¿Qué método de HttpServletResponse se utiliza para crear cabeceras HTTP como Set-Cookie?",
                options: [
                    "a) sendRedirect()",
                    "b) sendError()",
                    "c) addCookie(Cookie)",
                    "d) setContentType()"
                ],
                correctAnswer: "c) addCookie(Cookie)"
            },
            {
                question: "¿Cuál es la diferencia entre sendError(int) y sendRedirect(String) en HttpServletResponse?",
                options: [
                    "a) sendError() envía errores 4xx/5xx; sendRedirect() envía una nueva URL con código 3xx.",
                    "b) sendError() redirige a una página de error; sendRedirect() solo muestra un mensaje.",
                    "c) sendError() es para errores de cliente; sendRedirect() para errores de servidor.",
                    "d) Son métodos idénticos con nombres diferentes."
                ],
                correctAnswer: "a) sendError() envía errores 4xx/5xx; sendRedirect() envía una nueva URL con código 3xx."
            },
            {
                question: "¿Por qué los desarrolladores de Servlets suelen heredar de HttpServlet en lugar de implementar directamente la interfaz Servlet?",
                options: [
                    "a) HttpServlet es una interfaz más completa.",
                    "b) HttpServlet proporciona métodos convenientes como doGet(), doPost() para diferentes verbos HTTP.",
                    "c) La interfaz Servlet está obsoleta.",
                    "d) HttpServlet garantiza la seguridad de las peticiones."
                ],
                correctAnswer: "b) HttpServlet proporciona métodos convenientes como doGet(), doPost() para diferentes verbos HTTP."
            },
            {
                question: "¿Qué es JSESSIONID?",
                options: [
                    "a) Un identificador de sesión para bases de datos.",
                    "b) El nombre de la cookie que contiene el ID en Java para identificar al usuario HTTP.",
                    "c) Un protocolo de comunicación entre servidores.",
                    "d) Un identificador de seguridad para EJBs."
                ],
                correctAnswer: "b) El nombre de la cookie que contiene el ID en Java para identificar al usuario HTTP."
            },
            {
                question: "¿Quién asigna el JSESSIONID y durante cuánto tiempo se mantiene?",
                options: [
                    "a) El cliente; hasta que se cierra el navegador.",
                    "b) El servidor de aplicaciones; durante toda la sesión.",
                    "c) El servidor web (Apache/Nginx); por cada petición.",
                    "d) El desarrollador; de forma manual."
                ],
                correctAnswer: "b) El servidor de aplicaciones; durante toda la sesión."
            },
            {
                question: "¿Por qué HTTP necesita cookies para mantener el estado?",
                options: [
                    "a) Porque es un protocolo de transporte de archivos.",
                    "b) Porque es un protocolo sin estado.",
                    "c) Para optimizar la carga de páginas web.",
                    "d) Para cifrar la comunicación."
                ],
                correctAnswer: "b) Porque es un protocolo sin estado."
            },
            {
                question: "En la estructura de una aplicación web, ¿qué elemento en web.xml se utiliza para configurar un filtro y mapearlo a una URL?",
                options: [
                    "a) <servlet> y <servlet-mapping>",
                    "b) <filter> y <filter-mapping>",
                    "c) <listener> y <listener-mapping>",
                    "d) <ejb-jar> y <session>"
                ],
                correctAnswer: "b) <filter> y <filter-mapping>"
            },
            {
                question: "¿Qué indica el elemento <load-on-startup>1</load-on-startup> en la configuración de un Servlet?",
                options: [
                    "a) Que el Servlet se cargará bajo demanda.",
                    "b) Que el Servlet se cargará al iniciar la aplicación.",
                    "c) Que el Servlet se cargará después de 1 segundo.",
                    "d) Que el Servlet es un Singleton."
                ],
                correctAnswer: "b) Que el Servlet se cargará al iniciar la aplicación."
            },
            {
                question: "En la configuración de seguridad (security-constraint) de web.xml, ¿qué rol (<role-name>) podría acceder a una URL /admin/ con el rol ADMIN?",
                options: [
                    "a) USER",
                    "b) GUEST",
                    "c) ADMIN",
                    "d) ANY"
                ],
                correctAnswer: "c) ADMIN"
            },
            {
                question: "¿Qué etiqueta se utiliza en web.xml para configurar el tiempo de espera de una sesión HTTP?",
                options: [
                    "a) <session-duration>",
                    "b) <session-timeout>",
                    "c) <session-config>",
                    "d) <session-lifetime>"
                ],
                correctAnswer: "b) <session-timeout>"
            },
            {
                question: "¿Qué formato de archivo tienen los EJBs?",
                options: [
                    "a) .war",
                    "b) .ear",
                    "c) .jar",
                    "d) .zip"
                ],
                correctAnswer: "c) .jar"
            },
            {
                question: "En JPA, ¿dónde se define el DataSource que la aplicación utilizará para la conexión a la base de datos?",
                options: [
                    "a) En web.xml",
                    "b) En application.xml",
                    "c) En persistence.xml",
                    "d) En el código Java con @DataSource"
                ],
                correctAnswer: "c) En persistence.xml"
            },
            {
                question: "¿Qué método del EntityManager se utiliza para comprobar si una entidad está 'manejada' (gestionada) por el EM?",
                options: [
                    "a) persist()",
                    "b) find()",
                    "c) contains(obj)",
                    "d) merge()"
                ],
                correctAnswer: "c) contains(obj)"
            },
            {
                question: "¿Qué método de EntityManager provoca que los cambios pendientes se sincronicen con la base de datos?",
                options: [
                    "a) persist()",
                    "b) find()",
                    "c) flush()",
                    "d) remove()"
                ],
                correctAnswer: "c) flush()"
            },
            {
                question: "¿Qué método de EntityManager se utiliza para convertir una entidad 'no manejada' en 'manejada'?",
                options: [
                    "a) persist()",
                    "b) find()",
                    "c) merge(obj)",
                    "d) remove()"
                ],
                correctAnswer: "c) merge(obj)"
            },
            {
                question: "¿Qué método de EntityManager se utiliza para eliminar una entidad de la base de datos?",
                options: [
                    "a) persist()",
                    "b) find()",
                    "c) merge()",
                    "d) remove(obj)"
                ],
                correctAnswer: "d) remove(obj)"
            },
            {
                question: "¿Qué es JPQL?",
                options: [
                    "a) Un lenguaje de consulta SQL optimizado.",
                    "b) Un lenguaje de consulta SQL que usa nombres de clases en vez de tablas.",
                    "c) Un lenguaje de programación Java.",
                    "d) Una API para procesar JSON."
                ],
                correctAnswer: "b) Un lenguaje de consulta SQL que usa nombres de clases en vez de tablas."
            },
            {
                question: "En JPA, ¿qué significa la estrategia de carga EAGER?",
                options: [
                    "a) Que solo se trae la entidad principal.",
                    "b) Que se trae todo lo que está relacionado con la entidad.",
                    "c) Que la carga se realiza de forma asíncrona.",
                    "d) Que la carga se realiza bajo demanda."
                ],
                correctAnswer: "b) Que se trae todo lo que está relacionado con la entidad."
            },
            {
                question: "¿Cuál es la estrategia de carga por defecto para las anotaciones @OneToOne y @OneToMany en JPA?",
                options: [
                    "a) FetchType.EAGER",
                    "b) FetchType.LAZY",
                    "c) FetchType.DEFAULT",
                    "d) FetchType.IMMEDIATE"
                ],
                correctAnswer: "b) FetchType.LAZY"
            },
            {
                question: "¿Qué anotación JPA se utiliza para elegir la tabla donde guardar un objeto?",
                options: [
                    "a) @Column",
                    "b) @Entity",
                    "c) @Table",
                    "d) @Id"
                ],
                correctAnswer: "c) @Table"
            },
            {
                question: "¿Qué anotación JPA se utiliza para indicar que un atributo de una entidad no debe ser persistido en la base de datos?",
                options: [
                    "a) @Column",
                    "b) @Transient",
                    "c) @Id",
                    "d) @NamedQuery"
                ],
                correctAnswer: "b) @Transient"
            },
            {
                question: "¿Qué anotación JPA se utiliza para especificar una consulta JPQL con nombre?",
                options: [
                    "a) @Query",
                    "b) @NativeQuery",
                    "c) @NamedQuery",
                    "d) @Select"
                ],
                correctAnswer: "c) @NamedQuery"
            },
            {
                question: "¿Qué anotación JPA se utiliza para un método que se lanza antes del commit de una entidad?",
                options: [
                    "a) @PreUpdate",
                    "b) @PostPersist",
                    "c) @PrePersist",
                    "d) @PostUpdate"
                ],
                correctAnswer: "c) @PrePersist"
            },
            {
                question: "¿Cuál es el rol de HttpServlet en relación con la interfaz Servlet?",
                options: [
                    "a) Es una interfaz más potente que Servlet.",
                    "b) Es una clase de utilidad que implementa la interfaz Servlet y facilita la gestión de peticiones HTTP.",
                    "c) Es una clase abstracta que no se puede heredar.",
                    "d) Sustituye por completo a la interfaz Servlet."
                ],
                correctAnswer: "b) Es una clase de utilidad que implementa la interfaz Servlet y facilita la gestión de peticiones HTTP."
            },
            {
                question: "¿Qué significa el concepto de 'Inyección de Dependencias' en JEE?",
                options: [
                    "a) Es una técnica para que las clases se creen entre sí directamente.",
                    "b) Es una técnica donde el runtime EE es el encargado de colocar objetos en los atributos de una clase.",
                    "c) Es un patrón de diseño que obliga a modificar el código fuente para actualizar versiones de dependencias.",
                    "d) Es una forma de desacoplar los gestores de colas de mensajes."
                ],
                correctAnswer: "b) Es una técnica donde el runtime EE es el encargado de colocar objetos en los atributos de una clase."
            },
            {
                question: "¿Cuál de los siguientes no es un perfil de Jakarta EE 10?",
                options: [
                    "a) Jakarta EE Platform",
                    "b) Jakarta EE Web Profile",
                    "c) Jakarta EE Core Profile",
                    "d) Jakarta EE Mobile Profile"
                ],
                correctAnswer: "d) Jakarta EE Mobile Profile"
            },
            {
                question: "¿Qué API forma parte del Jakarta EE Core Profile?",
                options: [
                    "a) Jakarta EE Server Pages",
                    "b) Jakarta EE Batch",
                    "c) Jakarta EE Faces",
                    "d) Jakarta EE Mail"
                ],
                correctAnswer: "b) Jakarta EE Batch"
            },
            {
                question: "¿Qué API permite la inyección de dependencias en JEE?",
                options: [
                    "a) JTA",
                    "b) JPA",
                    "c) CDI",
                    "d) JMS"
                ],
                correctAnswer: "c) CDI"
            },
            {
                question: "¿Qué componente de JEE se describe como 'muy cerca del cliente' y reside en el Web Container?",
                options: [
                    "a) EJB Session",
                    "b) EJB MDB",
                    "c) Capa Presentación",
                    "d) Capa Negocio"
                ],
                correctAnswer: "c) Capa Presentación"
            },
            {
                question: "¿Cuál es la principal función de un Servlet?",
                options: [
                    "a) Procesar la lógica de negocio.",
                    "b) Canalizar una URL de petición/negocio al resto de capas de la aplicación.",
                    "c) Gestionar la persistencia de datos.",
                    "d) Enviar mensajes a una cola JMS."
                ],
                correctAnswer: "b) Canalizar una URL de petición/negocio al resto de capas de la aplicación."
            },
            {
                question: "¿Qué significa que un EJB Session sea 'sin estado'?",
                options: [
                    "a) Que no puede realizar operaciones transaccionales.",
                    "b) Que no guarda información entre llamadas al cliente.",
                    "c) Que no tiene acceso a la base de datos.",
                    "d) Que no puede ser un componente Singleton."
                ],
                correctAnswer: "b) Que no guarda información entre llamadas al cliente."
            },
            {
                question: "¿Qué API es el cliente para el servicio de colas de mensajes en JEE?",
                options: [
                    "a) JSON-P",
                    "b) JDBC",
                    "c) JAX-RS",
                    "d) JMS"
                ],
                correctAnswer: "d) JMS"
            },
            {
                question: "¿Qué protocolo utiliza JTA para gestionar transacciones en bases de datos distribuidas?",
                options: [
                    "a) SOAP",
                    "b) REST",
                    "c) Two-phase commit",
                    "d) HTTP"
                ],
                correctAnswer: "c) Two-phase commit"
            },
            {
                question: "¿Cuál de los siguientes es un ejemplo de un monitor transaccional mencionado en el contexto de JTA?",
                options: [
                    "a) Apache Kafka",
                    "b) RabbitMQ",
                    "c) CICS",
                    "d) Redis"
                ],
                correctAnswer: "c) CICS"
            },
            {
                question: "¿Qué ventaja ofrece el uso de PreparedStatement en JDBC?",
                options: [
                    "a) Permite ejecutar cualquier tipo de SQL dinámico.",
                    "b) Elimina el posible SQL Injection.",
                    "c) Mejora la legibilidad del código.",
                    "d) Permite conexiones directas a la base de datos sin un DataSource."
                ],
                correctAnswer: "b) Elimina el posible SQL Injection."
            },
            {
                question: "¿Qué objeto principal de JDBC se utiliza para obtener los resultados de una consulta a la base de datos?",
                options: [
                    "a) Connection",
                    "b) Statement",
                    "c) ResultSet",
                    "d) CallableStatement"
                ],
                correctAnswer: "c) ResultSet"
            },
            {
                question: "¿Qué tipo de relación JMS permite que varios consumidores reciban el mismo mensaje, difundiéndolo a todos?",
                options: [
                    "a) Queue (1:1)",
                    "b) Topic (1:N)",
                    "c) Point-to-point",
                    "d) Request-reply"
                ],
                correctAnswer: "b) Topic (1:N)"
            },
            {
                question: "¿Qué métodos de EntityManager son utilizados para manipular entidades en la base de datos?",
                options: [
                    "a) open(), close(), commit()",
                    "b) create(), read(), update(), delete()",
                    "c) persist(), find(), remove()",
                    "d) start(), stop(), process()"
                ],
                correctAnswer: "c) persist(), find(), remove()"
            },
            {
                question: "¿Qué anotación JPA se utiliza para especificar relaciones uno a muchos con otras clases?",
                options: [
                    "a) @OneToOne",
                    "b) @ManyToOne",
                    "c) @OneToMany",
                    "d) @ManyToMany"
                ],
                correctAnswer: "c) @OneToMany"
            },
            {
                question: "¿Qué es HttpServletRequestWrapper?",
                options: [
                    "a) Una interfaz para envolver peticiones HTTP.",
                    "b) Una clase de utilidad para decorar o extender HttpServletRequest.",
                    "c) Un filtro para validar peticiones HTTP.",
                    "d) Un componente para manejar sesiones HTTP."
                ],
                correctAnswer: "b) Una clase de utilidad para decorar o extender HttpServletRequest."
            },
            {
                question: "¿Cómo se llama el proceso de especificación de Jakarta EE?",
                options: [
                    "a) JEE Specification Process (JSP)",
                    "b) Jakarta EE Standard Process (JESP)",
                    "c) Jakarta EE Specification Process (JESP)",
                    "d) Eclipse Jakarta Standard (EJS)"
                ],
                correctAnswer: "c) Jakarta EE Specification Process (JESP)"
            },
            {
                question: "¿Qué API de Jakarta EE 10 está relacionada con la persistencia?",
                options: [
                    "a) Jakarta EE Authentication",
                    "b) Jakarta EE Concurrency",
                    "c) Jakarta EE Persistence",
                    "d) Jakarta EE Batch"
                ],
                correctAnswer: "c) Jakarta EE Persistence"
            },
            {
                question: "¿Qué se consigue con la 'Inyección de Dependencias' en JEE con CDI?",
                options: [
                    "a) Acoplamiento fuerte entre los componentes.",
                    "b) Mayor dificultad para actualizar versiones de las dependencias.",
                    "c) Abstracción de las versiones y relación con el polimorfismo.",
                    "d) Mayor complejidad en la configuración de la aplicación."
                ],
                correctAnswer: "c) Abstracción de las versiones y relación con el polimorfismo."
            },
            {
                question: "¿Qué característica principal tienen los Servlet y Filter en cuanto a su ciclo de vida dentro del Web Container?",
                options: [
                    "a) Se crean por cada petición.",
                    "b) Se crea un objeto de cada clase al inicio de la aplicación.",
                    "c) Se destruyen después de cada petición.",
                    "d) Son objetos globales compartidos por todos los usuarios."
                ],
                correctAnswer: "b) Se crea un objeto de cada clase al inicio de la aplicación."
            },
            {
                question: "¿Qué objeto global es compartido por todos los Servlets en una aplicación web?",
                options: [
                    "a) HttpServletRequest",
                    "b) HttpServletResponse",
                    "c) HttpSession",
                    "d) ServletContext"
                ],
                correctAnswer: "d) ServletContext"
            },
            {
                question: "En el diagrama de flujo de aplicación web, ¿qué se crea continuamente por cada petición junto con su Thread correspondiente?",
                options: [
                    "a) HttpSession",
                    "b) ServletContext",
                    "c) req y res (ServletRequest y ServletResponse)",
                    "d) Filter y Servlet"
                ],
                correctAnswer: "c) req y res (ServletRequest y ServletResponse)"
            },
            {
                question: "¿Qué tipo de garantía de transporte (transport-guarantee) se menciona en la configuración de seguridad de web.xml?",
                options: [
                    "a) CONFIDENTIAL",
                    "b) INTEGRAL",
                    "c) NONE",
                    "d) REQUIRED"
                ],
                correctAnswer: "c) NONE"
            },
            {
                question: "¿Qué significa context-root en el application.xml de un .ear?",
                options: [
                    "a) Es el nombre del archivo .war.",
                    "b) Es la URL base bajo la cual se desplegará la aplicación web.",
                    "c) Es el nombre de la clase principal de la aplicación.",
                    "d) Es la ruta del servidor de aplicaciones."
                ],
                correctAnswer: "b) Es la URL base bajo la cual se desplegará la aplicación web."
            },
            {
                question: "¿Qué fichero de configuración de EJB ya no se usa, siendo reemplazado por anotaciones como @Stateless?",
                options: [
                    "a) application.xml",
                    "b) web.xml",
                    "c) META-INF\\ejb-jar.xml",
                    "d) persistence.xml"
                ],
                correctAnswer: "c) META-INF\\ejb-jar.xml"
            },
            {
                question: "En la gestión de transacciones de EJBs, ¿qué significa el tipo de transacción 'Container'?",
                options: [
                    "a) Que las transacciones son gestionadas por el desarrollador.",
                    "b) Que las transacciones son gestionadas automáticamente por el contenedor del EJB.",
                    "c) Que las transacciones son gestionadas por el cliente.",
                    "d) Que las transacciones son solo de lectura."
                ],
                correctAnswer: "b) Que las transacciones son gestionadas automáticamente por el contenedor del EJB."
            },
            {
                question: "¿Qué es la carga LAZY en JPA y para qué tipo de relaciones es por defecto?",
                options: [
                    "a) Carga la entidad y todas sus relaciones de inmediato; por defecto en @OneToOne.",
                    "b) Carga solo la entidad principal y las relaciones bajo demanda; por defecto en @OneToOne y @OneToMany.",
                    "c) Carga los datos de forma asíncrona; por defecto en @ManyToMany.",
                    "d) Carga solo los datos básicos; por defecto en @ElementCollection."
                ],
                correctAnswer: "b) Carga solo la entidad principal y las relaciones bajo demanda; por defecto en @OneToOne y @OneToMany."
            },
            {
                question: "¿Qué anotación se utiliza para especificar un método que se lanza de forma similar a un trigger en JPA?",
                options: [
                    "a) @PrePersist",
                    "b) @PostLoad",
                    "c) @PreUpdate",
                    "d) @PostRemove"
                ],
                correctAnswer: "c) @PreUpdate"
            },
            {
                question: "¿Cuál de las siguientes afirmaciones sobre el Web Container es correcta?",
                options: [
                    "a) Es donde viven los componentes de la capa de negocio.",
                    "b) Contiene la lógica para entender el mundo HTTP y llamar al código Java.",
                    "c) Es el gestor de transacciones distribuidas.",
                    "d) Es un servicio de colas de mensajes."
                ],
                correctAnswer: "b) Contiene la lógica para entender el mundo HTTP y llamar al código Java."
            }
        ];


        // Variables de estado del quiz
        let currentQuestionIndex = 0;
        let score = 0;
        // userAnswers guarda el texto de la opción seleccionada (o null)
        const userAnswers = new Array(quizData.length).fill(null);
        // scoredQuestions guarda true si la pregunta fue respondida correctamente, false si fue incorrecta o no respondida
        const scoredQuestions = new Array(quizData.length).fill(false); 

        // Referencias a los elementos del DOM
        const quizContainer = document.getElementById('quizContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const restartBtn = document.getElementById('restartBtn');
        const restartInlineBtn = document.getElementById('restartInlineBtn');
        const finalScoreDiv = document.getElementById('finalScore');
        const progressBar = document.getElementById('progressBar');
        const finalScoreDisplay = finalScoreDiv.querySelector('.score-display');
        const correctCountSpan = document.getElementById('correctCount');
        const incorrectCountSpan = document.getElementById('incorrectCount');
        const unansweredCountSpan = document.getElementById('unansweredCount');

        /**
         * Carga el estado del quiz guardado en localStorage.
         * Si no existe, inicializa un nuevo estado.
         */
        function loadQuizState() {
            try {
                const savedState = JSON.parse(localStorage.getItem('quizState'));
                if (savedState) {
                    currentQuestionIndex = savedState.currentQuestionIndex;
                    score = savedState.score;
                    // Asegurarse de que los arrays tengan el tamaño correcto y copiar los valores
                    userAnswers.splice(0, savedState.userAnswers.length, ...savedState.userAnswers);
                    scoredQuestions.splice(0, savedState.scoredQuestions.length, ...savedState.scoredQuestions);
                }
            } catch (e) {
                console.error("Error al cargar el estado del quiz:", e);
                // Si hay un error, el estado se reiniciará a los valores por defecto
            }
        }

        /**
         * Guarda el estado actual del quiz en localStorage.
         */
        function saveQuizState() {
            const quizState = {
                currentQuestionIndex: currentQuestionIndex,
                score: score,
                userAnswers: userAnswers,
                scoredQuestions: scoredQuestions
            };
            localStorage.setItem('quizState', JSON.stringify(quizState));
        }

        /**
         * Carga y muestra la pregunta actual.
         */
        function loadQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }

            const currentQuestion = quizData[currentQuestionIndex];
            quizContainer.innerHTML = `
                <div class="question-card">
                    <p class="question-text">${currentQuestionIndex + 1}. ${currentQuestion.question}</p>
                    <div class="options-container">
                        ${currentQuestion.options.map((option) => `
                            <button class="option-button" data-option="${option}">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                    <div class="solution hidden">
                        <strong>Solución:</strong> <span class="solution-text"></span>
                    </div>
                </div>
            `;

            const optionsContainer = quizContainer.querySelector('.options-container');
            const questionCard = quizContainer.querySelector('.question-card');

            // Añade el evento de clic a los botones de opción
            optionsContainer.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', handleOptionClick);
            });

            // Resalta la respuesta del usuario si ya ha respondido y aplica estilos
            const savedAnswer = userAnswers[currentQuestionIndex];
            if (savedAnswer !== null) {
                const selectedButton = optionsContainer.querySelector(`[data-option="${savedAnswer}"]`);
                if (selectedButton) {
                    // Deshabilita todos los botones para que no se pueda cambiar la respuesta
                    optionsContainer.querySelectorAll('.option-button').forEach(button => {
                        button.classList.add('disabled');
                        button.removeEventListener('click', handleOptionClick); // Remover listener si ya está respondida
                    });

                    // Aplica los estilos de la respuesta guardada
                    const isCorrect = (savedAnswer === currentQuestion.correctAnswer);
                    if (isCorrect) {
                        selectedButton.classList.add('correct-answer');
                        questionCard.classList.add('correct');
                    } else {
                        selectedButton.classList.add('incorrect-answer');
                        questionCard.classList.add('incorrect');
                        // Muestra la respuesta correcta si la guardada fue incorrecta
                        const correctButton = optionsContainer.querySelector(`[data-option="${currentQuestion.correctAnswer}"]`);
                        if (correctButton) {
                            correctButton.classList.add('correct-answer');
                        }
                    }
                    // Añadir feedback visual (Correcto/Incorrecto)
                    updateQuestionCardVisuals(isCorrect);
                }
            }

            // Actualiza el estado de los botones de navegación y la barra de progreso
            updateNavButtons();
            updateProgressBar();
        }

        /**
         * Maneja el evento de clic en una opción de respuesta.
         * @param {Event} event - El evento de clic.
         */
        function handleOptionClick(event) {
            const selectedOptionButton = event.target;
            const selectedOption = selectedOptionButton.dataset.option;
            const currentQuestion = quizData[currentQuestionIndex];
            const optionsContainer = quizContainer.querySelector('.options-container');
            const questionCard = quizContainer.querySelector('.question-card');

            // Deshabilita todos los botones de opción para evitar múltiples respuestas
            optionsContainer.querySelectorAll('.option-button').forEach(button => {
                button.classList.add('disabled');
                button.removeEventListener('click', handleOptionClick);
            });

            // Actualiza la respuesta del usuario y la guarda
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // Comprueba si la respuesta es correcta
            const isCorrectAttempt = (selectedOption === currentQuestion.correctAnswer);

            if (isCorrectAttempt) {
                selectedOptionButton.classList.add('correct-answer');
                questionCard.classList.add('correct');
                // Si no se ha puntuado antes, añade un punto y marca como correcta
                if (!scoredQuestions[currentQuestionIndex]) { // scoredQuestions[index] will be false if not yet scored
                    score++;
                    scoredQuestions[currentQuestionIndex] = true; // Marca como correcta
                }
            } else {
                selectedOptionButton.classList.add('incorrect-answer');
                questionCard.classList.add('incorrect');
                // Si se había puntuado como correcta (porque el usuario cambió de opinión), quita el punto
                if (scoredQuestions[currentQuestionIndex]) { // scoredQuestions[index] will be true if it was previously correct
                    score--;
                    scoredQuestions[currentQuestionIndex] = false; // Marca como incorrecta
                }
                // Resalta la respuesta correcta
                const correctAnswerButton = optionsContainer.querySelector(`[data-option="${currentQuestion.correctAnswer}"]`);
                if (correctAnswerButton) {
                    correctAnswerButton.classList.add('correct-answer');
                }
            }
            
            saveQuizState(); // Guarda el estado después de actualizar score y scoredQuestions

            // Añadir feedback visual (Correcto/Incorrecto)
            updateQuestionCardVisuals(isCorrectAttempt);

            // Muestra la solución detallada si existe (aunque no hay en tu quizData actual)
            if (currentQuestion.solution) {
                const solutionDiv = quizContainer.querySelector('.solution');
                solutionDiv.classList.remove('hidden');
                solutionDiv.querySelector('.solution-text').textContent = currentQuestion.solution;
            }
        }

        /**
         * Actualiza el estilo de la tarjeta de pregunta y añade feedback visual.
         * @param {boolean} isCorrect - Indica si la respuesta es correcta.
         */
        function updateQuestionCardVisuals(isCorrect) {
            const questionCard = document.querySelector('.question-card');
            // Eliminar feedback anterior si existe
            const existingFeedback = questionCard.querySelector('.feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }

            const feedbackMessage = document.createElement('p');
            feedbackMessage.classList.add('feedback');

            if (isCorrect) {
                feedbackMessage.textContent = '¡Correcto!';
                feedbackMessage.classList.add('correct');
            } else {
                feedbackMessage.textContent = 'Incorrecto. La respuesta correcta es la marcada en verde.';
                feedbackMessage.classList.add('incorrect');
            }
            questionCard.appendChild(feedbackMessage);
        }

        /**
         * Muestra los resultados finales del quiz.
         */
        function showResults() {
            quizContainer.classList.add('hidden');
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            restartInlineBtn.classList.add('hidden');
            progressBar.parentElement.classList.add('hidden');
            finalScoreDiv.classList.remove('hidden');

            // Calcula y muestra las estadísticas
            const correctAnswers = scoredQuestions.filter(isCorrect => isCorrect).length;
            // Una respuesta es incorrecta si el usuario respondió (no es null) Y no fue marcada como correcta (scoredQuestions[index] es false)
            const incorrectAnswers = userAnswers.filter((answer, index) => answer !== null && !scoredQuestions[index]).length;
            const unansweredQuestions = userAnswers.filter(answer => answer === null).length;

            finalScoreDisplay.textContent = `Tu puntuación final es ${correctAnswers} de ${quizData.length}`;
            correctCountSpan.textContent = correctAnswers;
            incorrectCountSpan.textContent = incorrectAnswers;
            unansweredCountSpan.textContent = unansweredQuestions;
        }
		
        /**
         * Actualiza el estado de los botones de navegación.
         */
        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.textContent = currentQuestionIndex === quizData.length - 1 ? 'Finalizar' : 'Siguiente';
        }

        /**
         * Actualiza la barra de progreso.
         */
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        /**
         * Reinicia el quiz a su estado inicial.
         */
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers.fill(null);
            scoredQuestions.fill(false);
            localStorage.clear(); // Limpia el localStorage
            
            quizContainer.classList.remove('hidden');
            prevBtn.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            restartInlineBtn.classList.remove('hidden');
            progressBar.parentElement.classList.remove('hidden');
            finalScoreDiv.classList.add('hidden');
            loadQuestion();
        }

        // Event listeners
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        });

        restartBtn.addEventListener('click', restartQuiz);
        restartInlineBtn.addEventListener('click', restartQuiz);

        // Carga inicial
        window.onload = function() {
            loadQuizState();
            loadQuestion();
        };
    </script>
</body>
</html>


