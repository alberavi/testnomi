<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORREO</title>
    <!-- Enlace a Tailwind CSS para las clases de la estructura HTML -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS completo para el estilo del quiz -->
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Contenedor principal del quiz */
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
        }

        /* Tarjeta de la pregunta */
        .question-card {
            background-color: #f8fafc;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease-in-out;
        }

        /* Estilo para la tarjeta de pregunta correcta */
        .question-card.correct {
            background-color: #d4edda;
            border-color: #28a745;
        }

        /* Estilo para la tarjeta de pregunta incorrecta */
        .question-card.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }

        /* Texto de la pregunta */
        .question-text {
            font-size: 1.15rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        /* Botones de opciones */
        .option-button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 18px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #cbd5e0;
            background-color: #ffffff;
            color: #4a5568;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Efecto hover para los botones de opciones */
        .option-button:hover:not(.disabled) {
            background-color: #e2e8f0;
            border-color: #a0aec0;
        }

        /* Estilo para el botón de opción seleccionado */
        .option-button.selected {
            border-color: #4299e1;
            background-color: #ebf8ff;
            font-weight: 600;
        }

        /* Estilo para la respuesta correcta */
        .option-button.correct-answer {
            background-color: #28a745;
            color: #ffffff;
            border-color: #28a745;
            font-weight: 700;
        }

        /* Estilo para la respuesta incorrecta */
        .option-button.incorrect-answer {
            background-color: #dc3545;
            color: #ffffff;
            border-color: #dc3545;
            font-weight: 700;
        }

        /* Estilo para los botones deshabilitados */
        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Contenedor de la solución */
        .solution {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #e0f2f7;
            color: #2c5282;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid #90cdf4;
        }

        /* Contenedor del feedback (correcto/incorrecto) */
        .feedback {
            margin-top: 15px;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
        }

        /* Estilo para feedback correcto */
        .feedback.correct {
            color: #28a745;
        }

        /* Estilo para feedback incorrecto */
        .feedback.incorrect {
            color: #dc3545;
        }

        /* Contenedor de los botones de navegación */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Estilo base para los botones de navegación */
        .nav-button {
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            text-align: center;
        }

        /* Estilo para el botón "Anterior" */
        .nav-button.prev {
            background-color: #6b7280;
            color: #ffffff;
        }
        .nav-button.prev:hover:not(:disabled) {
            background-color: #4b5563;
            transform: translateY(-2px);
        }

        /* Estilo para el botón "Siguiente" */
        .nav-button.next {
            background-color: #4299e1;
            color: #ffffff;
        }
        .nav-button.next:hover:not(:disabled) {
            background-color: #3182ce;
            transform: translateY(-2px);
        }

        /* Estilo para el botón de reinicio en línea */
        .nav-button.restart-inline {
            background-color: #f50b0b;
            color: #ffffff;
        }
        .nav-button.restart-inline:hover:not(:disabled) {
            background-color: #ac0505;
            transform: translateY(-2px);
        }

        /* Estilo para los botones deshabilitados */
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Barra de progreso */
        .progress-bar-container {
            width: 100%;
            background-color: #e2e8f0;
            border-radius: 5px;
            height: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #4299e1;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        /* Visualización de la puntuación final */
        .score-display {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-top: 20px;
        }

        /* Resumen de resultados */
        .results-summary {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .results-summary p {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #2d3748;
        }

        .results-summary p strong {
            font-weight: 700;
        }

        /* Botón de reinicio final */
        .restart-button {
            display: block;
            width: fit-content;
            margin: 20px auto 0 auto;
            padding: 12px 30px;
            background-color: #48bb78;
            color: #ffffff;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .restart-button:hover {
            background-color: #38a169;
            transform: translateY(-2px);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
         <h1 style="color: #003366; font-family: 'Georgia', serif; font-size: 2rem; text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">CORREO</h1>

        <!-- Barra de progreso -->
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>

        <!-- Contenedor principal de las preguntas -->
        <div id="quizContainer">
            <!-- Las preguntas se cargarán dinámicamente aquí -->
        </div>

        <!-- Botones de navegación -->
        <div class="navigation-buttons">
            <button id="prevBtn" class="nav-button prev" disabled>Anterior</button>
            <button id="restartInlineBtn" class="nav-button restart-inline">Reiniciar Test</button>
            <button id="nextBtn" class="nav-button next">Siguiente</button>
        </div>

        <!-- Contenedor de la puntuación final -->
        <div id="finalScore" class="hidden">
            <div class="score-display"></div>
            <div class="results-summary">
                <p><strong>Preguntas Correctas:</strong> <span id="correctCount">0</span></p>
                <p><strong>Preguntas Incorrectas:</strong> <span id="incorrectCount">0</span></p>
                <p><strong>Preguntas Sin Contestar:</strong> <span id="unansweredCount">0</span></p>
            </div>
            <button id="restartBtn" class="restart-button">Reiniciar Test</button>
        </div>
    </div>

    <script>
        // Array de datos del quiz con preguntas, opciones y respuestas correctas.
        // Puedes copiar y pegar tu array 'quizData' aquí.
        const quizData = [
            {
                question: "¿Qué significa la sigla MUA en el contexto del correo electrónico?",
                options: ["A) Mail Upload Agent", "B) Mail User Agent", "C) Mail Universal Access", "D) Mail Utility Adapter"],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es el rol principal de una MSA en una organización según el documento?",
                options: ["A) Recepción de correos entrantes.", "B) Gobernar el envío de mails para distribuir y dividir de forma controlada y evitar el colapso de las MTAs.", "C) Almacenar correos electrónicos antes de ser descargados por el usuario.", "D) Convertir el formato de correo electrónico para permitir adjuntos."],
                correctAnswer: "B"
            },
            {
                question: "Según el esquema, ¿qué protocolo utiliza un MUA para enviar un correo a la LAN/Internet?",
                options: ["A) POP3", "B) IMAP", "C) HTTP", "D) SMTP"],
                correctAnswer: "D"
            },
            {
                question: "¿Qué tipo de agente es responsable de la entrega de correos electrónicos a los buzones de los usuarios?",
                options: ["A) MTA", "B) MUA", "C) MDA", "D) MAA"],
                correctAnswer: "C"
            },
            {
                question: "¿Para qué se utiliza el \"Mail Spool\" en el proceso de recepción de correo?",
                options: ["A) Para el envío de correos salientes.", "B) Para almacenar físicamente los buzones de correo.", "C) Para la trazabilidad de los mensajes.", "D) Para la firma digital de los correos."],
                correctAnswer: "B"
            },
            {
                question: "Si un MAA ofreciera un servicio de webmail como OWA, ¿qué protocolo utilizaría en lugar de IMAP/POP3 para el acceso?",
                options: ["A) SMTP", "B) FTP", "C) HTTP", "D) SSH"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando POP3 se utiliza para listar el número de mensajes y su tamaño?",
                options: ["A) RETR", "B) STAT", "C) LIST", "D) DELE"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el puerto seguro para el protocolo POP3?",
                options: ["A) 110", "B) 143", "C) 993", "D) 995"],
                correctAnswer: "D"
            },
            {
                question: "En IMAP, ¿qué comando se utiliza para borrar mensajes con el flag \\Deleted activado?",
                options: ["A) DELE", "B) STORE", "C) EXPUNGE", "D) QUIT"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué característica principal diferencia a IMAP de POP3 en cuanto al manejo de los correos?",
                options: ["A) POP3 está orientado a carpetas en servidor, IMAP a descarga.", "B) IMAP está orientado a uso online y carpetas en servidor, POP3 a descarga.", "C) Ambos son orientados a descarga, pero IMAP es más seguro.", "D) POP3 permite almacenar adjuntos, IMAP no."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es el puerto por defecto para el envío de correos mediante SMTP?",
                options: ["A) 110", "B) 143", "C) 25", "D) 587"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando SMTP finaliza el envío del cuerpo de un mensaje?",
                options: ["A) QUIT", "B) DATA", "C) RCPT TO", "D) HELO"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué versión extendida de SMTP se indica mediante el comando EHLO?",
                options: ["A) SSMTP", "B) RSMTP", "C) ESMTP", "D) VSMTP"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es la finalidad de la característica STARTTLS en ESMTP?",
                options: ["A) Enviar credenciales sin cifrar.", "B) Pasar de modo no seguro a modo seguro.", "C) Autenticar al cliente en dos pasos.", "D) Firmar digitalmente los correos."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué método de autenticación en ESMTP envía el usuario y contraseña sin cifrar?",
                options: ["A) AUTH LOGIN", "B) AUTH MD5", "C) AUTH PLAIN", "D) AUTH CRAM-MD5"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué función tienen las cabeceras Received y Return-Path en un correo electrónico?",
                options: ["A) Indicar el destinatario del correo.", "B) Agrupar mensajes por hilos de conversación.", "C) Servir para la trazabilidad del MTA.", "D) Especificar el tipo de contenido del mensaje."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué extensión permite el envío de ficheros adjuntos en el correo electrónico?",
                options: ["A) RFC 822", "B) MIME", "C) SMTP", "D) POP3"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué cabecera MIME se utiliza para indicar el tipo de contenido del mensaje?",
                options: ["A) Content-Transfer-Encoding", "B) MIME-Version", "C) Content-Type", "D) Boundary"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál de las siguientes herramientas es un cliente de correo según el documento?",
                options: ["A) Postfix", "B) SendMail", "C) Mozilla Thunderbird", "D) Microsoft Exchange"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué servidor de correo es mencionado en el documento?",
                options: ["A) EM Client", "B) IBM Lotus Notes", "C) Zimbra", "D) Microsoft Outlook"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué tecnología de securización de correo permite a MTA2 verificar que un mail proviene de MTA1 comprobando IPs autorizadas en un registro TXT?",
                options: ["A) DKIM", "B) DMARC", "C) SPF", "D) ARC"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué securización de correo utiliza una clave privada para firmar los correos salientes y una clave pública (en un registro TXT) para validarlos?",
                options: ["A) SPF", "B) DMARC", "C) ARC", "D) DKIM"],
                correctAnswer: "D"
            },
            {
                question: "¿Qué combinación de tecnologías de securización de correo es DMARC?",
                options: ["A) SPF + ARC", "B) DKIM + ARC", "C) SPF + DKIM", "D) SPF + HTTP"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué técnica de autenticación garantiza toda la cadena de un correo electrónico?",
                options: ["A) SPF", "B) DKIM", "C) DMARC", "D) ARC"],
                correctAnswer: "D"
            },
            {
                question: "En la arquitectura DNS, ¿quién es el primero en ser consultado por el resolver si no tiene la información cacheada?",
                options: ["A) Top-Level Domain Server", "B) Authoritative Server", "C) Root Server", "D) El propio dominio"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué tipo de registro DNS mapea un nombre de dominio a una dirección IPv4?",
                options: ["A) Registro AAAA", "B) Registro CNAME", "C) Registro A", "D) Registro MX"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué tipo de registro DNS especifica el o los MTA(s) a los que deben ser entregados los emails?",
                options: ["A) Registro A", "B) Registro TXT", "C) Registro MX", "D) Registro PTR"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué registro DNS se utiliza como alias o redirección desde subdominios a otros dominios/subdominios?",
                options: ["A) Registro MX", "B) Registro TXT", "C) Registro CNAME", "D) Registro SRV"],
                correctAnswer: "C"
            },
            {
                question: "¿Para qué se utiliza comúnmente un registro TXT en relación con la seguridad del correo electrónico?",
                options: ["A) Para especificar el servidor de correo entrante.", "B) Para almacenar información sobre las direcciones IP de los usuarios.", "C) Para prevenir ataques de spoofing mediante SPF.", "D) Para el mapeo de direcciones IPv6."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué tipo de registro DNS se utiliza para indicar qué servicios se ofrecen bajo un dominio, como VoIP o el servicio de correo MSA?",
                options: ["A) Registro CNAME", "B) Registro TXT", "C) Registro SRV", "D) Registro PTR"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué registro DNS restringe qué entidades pueden expedir certificados para un determinado dominio?",
                options: ["A) Registro SOA", "B) Registro CAA", "C) Registro A", "D) Registro TXT"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué información se almacena en el registro SOA de DNS?",
                options: ["A) Las direcciones IP de los dominios.", "B) Información sobre los servicios ofrecidos.", "C) La dirección de correo electrónico del administrador y la última actualización del dominio.", "D) Los alias de los subdominios."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el puerto seguro para IMAP?",
                options: ["A) 110", "B) 143", "C) 993", "D) 995"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando IMAP permite la lectura de contenido, cabeceras, flags, etc.?",
                options: ["A) SELECT", "B) FETCH", "C) SEARCH", "D) STORE"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué comando IMAP se utiliza para modificar los flags de los mensajes?",
                options: ["A) DELE", "B) EXPUNGE", "C) STORE Flags", "D) STATUS"],
                correctAnswer: "C"
            },
            {
                question: "Según el diagrama, ¿qué protocolo se utiliza para la comunicación entre un MUA y un MAA?",
                options: ["A) SMTP", "B) HTTP", "C) POP3", "D) DNS"],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es la función principal de la cabecera Message-ID?",
                options: ["A) Indicar el remitente del correo.", "B) Agrupar mensajes por hilos de conversación.", "C) Especificar la fecha de envío del correo.", "D) Declarar el tipo de codificación del contenido."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué significa RFC 822 en el contexto del correo electrónico?",
                options: ["A) Un protocolo para el envío de adjuntos.", "B) Un estándar que solo permite texto ASCII (7+1 bits).", "C) Una extensión para la seguridad del correo.", "D) Un formato para la autenticación de usuarios."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué puerto SMTP ha quedado obsoleto según el documento?",
                options: ["A) 25", "B) 2525", "C) 587", "D) 465"],
                correctAnswer: "D" // Corrected based on user feedback
            },
            {
                question: "Si se utiliza AUTH LOGIN en ESMTP, ¿cómo se envían las credenciales?",
                options: ["A) En un solo paso, sin cifrar.", "B) En dos pasos, sin cifrar.", "C) Siempre cifradas.", "D) Mediante un certificado."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es una característica fundamental de las MSA según el documento?",
                options: ["A) Recibir correos electrónicos de otros dominios.", "B) Evitar que las MTAs colapsen debido a un envío masivo de correos.", "C) Almacenar los correos de los usuarios.", "D) Convertir el formato de los correos para incluir adjuntos."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué significa que una MTA por cada dominio esté configurada?",
                options: ["A) Que cada usuario tiene su propia MTA.", "B) Que cada dominio tiene una MTA dedicada para gestionar sus correos.", "C) Que una MTA puede gestionar múltiples dominios.", "D) Que la MTA es un componente opcional."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué es un Resolver en la arquitectura DNS?",
                options: ["A) Un servidor Root.", "B) Un servidor Authoritative.", "C) El servidor DNS configurado localmente (/etc/resolv.conf).", "D) Un servidor TLD."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el orden correcto de consulta en la arquitectura DNS cuando un resolver no tiene la IP cacheada?",
                options: ["A) Root Server -> Authoritative Server -> TLD Server.", "B) TLD Server -> Root Server -> Authoritative Server.", "C) Root Server -> TLD Server -> Authoritative Server.", "D) Authoritative Server -> Root Server -> TLD Server."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué registro DNS se utiliza para la búsqueda inversa (mapear IP a nombre de dominio)?",
                options: ["A) Registro A", "B) Registro MX", "C) Registro PTR", "D) Registro TXT"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué identifica el boundary en una cabecera Content-Type: multipart?",
                options: ["A) El remitente del correo.", "B) El final del mensaje.", "C) El cambio de contenido en el cuerpo del mensaje.", "D) La codificación del contenido."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál de los siguientes no es un valor válido para Content-Transfer-Encoding?",
                options: ["A) 7bit", "B) 8bit", "C) 16bit", "D) binary"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando POP3 se utiliza para marcar un mensaje para borrado?",
                options: ["A) LIST", "B) RETR", "C) DELE", "D) QUIT"],
                correctAnswer: "C"
            },
            {
                question: "Si en IMAP se ejecuta el comando DELE y luego QUIT, ¿qué sucede?",
                options: ["A) Los mensajes se marcan como borrados pero no se eliminan.", "B) Los mensajes marcados como borrados se eliminan.", "C) Se cierra la sesión sin afectar los mensajes.", "D) Se descargan todos los mensajes."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué se especifica con la cabecera Content-Type: application/pdf?",
                options: ["A) Que el cuerpo del mensaje es texto plano.", "B) Que el cuerpo del mensaje contiene múltiples partes.", "C) Que el cuerpo del mensaje es un documento PDF.", "D) Que el cuerpo del mensaje es una imagen GIF."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué protocolo es \"orientado a descarga\" y \"muy simple\"?",
                options: ["A) IMAP", "B) SMTP", "C) POP3", "D) HTTP"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando SMTP se utiliza para saludar al servidor y presentarse?",
                options: ["A) MAIL FROM", "B) RCPT TO", "C) HELO", "D) DATA"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué indica el comando EHLO en ESMTP en comparación con HELO en SMTP?",
                options: ["A) Un saludo de un cliente más antiguo.", "B) Un saludo que solicita extensiones ESMTP.", "C) Un saludo de un servidor de correo.", "D) Un saludo de un cliente de correo web."],
                correctAnswer: "B"
            },
            {
                question: "¿Por qué es importante cifrar el canal cuando se utilizan métodos de autenticación como AUTH PLAIN o AUTH LOGIN?",
                options: ["A) Para reducir el tamaño de los mensajes.", "B) Porque las credenciales se envían en texto claro.", "C) Para mejorar la velocidad de transmisión.", "D) Para evitar que el servidor colapse."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál de los siguientes no es un servidor de correo según el documento?",
                options: ["A) Postfix", "B) SendMail", "C) Microsoft Exchange", "D) Mozilla Thunderbird"],
                correctAnswer: "D"
            },
            {
                question: "¿Qué registro DNS es un componente de las bases de datos de los servidores autoritativos?",
                options: ["A) Registro MX", "B) Registro DNS", "C) Registro CNAME", "D) Registro TXT"],
                correctAnswer: "D"
            },
            {
                question: "¿Qué es el \"Spool\" en el contexto de correo electrónico?",
                options: ["A) Un servidor de envío de correos.", "B) El almacenamiento físico de los buzones de correo.", "C) Un protocolo de acceso al correo.", "D) Una herramienta de securización."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué cabecera en MIME se utiliza para indicar la versión de MIME?",
                options: ["A) Content-Type", "B) Content-Transfer-Encoding", "C) MIME-Version", "D) Boundary"],
                correctAnswer: "C"
            },
            {
                question: "Si una organización usa MSAs para \"no tumbar las MTAs\", ¿qué problema están tratando de evitar?",
                options: ["A) La pérdida de correos electrónicos.", "B) La saturación o caída de los servidores de transferencia de correo.", "C) Problemas de seguridad en los correos.", "D) Lentitud en la descarga de correos por parte de los usuarios."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es el significado de \"Acceso\" en el diagrama del lado del \"Destino\"?",
                options: ["A) El acceso del MUA al Mail Spool.", "B) El acceso del MUA al MAA.", "C) El acceso del MTA al MDA.", "D) El acceso del MDA al Mail Spool."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué comando IMAP permite buscar mensajes según criterios como FROM/TO o DATE?",
                options: ["A) SELECT", "B) FETCH", "C) SEARCH", "D) STATUS"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el puerto alternativo para SMTP que también se menciona?",
                options: ["A) 110", "B) 143", "C) 2525", "D) 993"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué registro DNS mapea un nombre de dominio a una dirección IPv6?",
                options: ["A) Registro A", "B) Registro AAAA", "C) Registro PTR", "D) Registro CNAME"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué significa \"Origen\" en el diagrama?",
                options: ["A) El servidor de correo del destinatario.", "B) El servidor de correo del remitente.", "C) El cliente de correo del remitente.", "D) El servidor DNS."],
                correctAnswer: "B" // Inferred from context
            },
            {
                question: "¿Qué componente del correo electrónico se encarga de la trazabilidad del mensaje entre diferentes MTAs?",
                options: ["A) MUA", "B) MDA", "C) Las cabeceras Received y Return-Path.", "D) El Mail Spool."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es la diferencia principal entre AUTH PLAIN y AUTH LOGIN?",
                options: ["A) AUTH PLAIN es seguro, AUTH LOGIN no.", "B) AUTH PLAIN es en un paso, AUTH LOGIN en dos.", "C) AUTH PLAIN requiere cifrado, AUTH LOGIN no.", "D) AUTH PLAIN es para enviar adjuntos, AUTH LOGIN no."],
                correctAnswer: "B"
            },
            {
                question: "Si se quiere ofrecer un servicio SIP bajo un dominio, ¿qué registro DNS se utilizaría?",
                options: ["A) Registro A", "B) Registro MX", "C) Registro SRV", "D) Registro TXT"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué es el \"Body\" de un correo electrónico en el contexto de RFC 822 y MIME?",
                options: ["A) La parte que contiene las cabeceras.", "B) La parte que contiene los ficheros adjuntos.", "C) El contenido principal del mensaje.", "D) La información de trazabilidad."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué indica el campo priority en un registro SRV?",
                options: ["A) La prioridad del servidor destino.", "B) El peso relativo para registros con la misma prioridad.", "C) El puerto del servicio.", "D) La dirección del servidor destino."],
                correctAnswer: "A" // Inferred from general SRV knowledge
            },
            {
                question: "¿Qué comando POP3 se utiliza para descargar un mensaje específico?",
                options: ["A) LIST", "B) STAT", "C) RETR", "D) DELE"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el significado de UNSEEN en el comando STATUS de IMAP?",
                options: ["A) Mensajes eliminados.", "B) Mensajes leídos.", "C) Mensajes no leídos.", "D) Mensajes recientes."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué tecnología de securización de correo implica que MTA1 firma sus correos de salida usando su clave privada?",
                options: ["A) SPF", "B) DKIM", "C) DMARC", "D) ARC"],
                correctAnswer: "B"
            },
            {
                question: "¿Dónde se almacena la clave pública para validar la firma DKIM de un correo?",
                options: ["A) En la cabecera DKIM-Signature.", "B) En el registro MX del dominio.", "C) En un registro TXT del dominio.", "D) En el Mail Spool."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál de las siguientes es una función de la cabecera Received?",
                options: ["A) Indicar el destinatario.", "B) La trazabilidad del MTA.", "C) El asunto del mensaje.", "D) La fecha de envío."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué implica que RFC 822 solo permita texto (ASCII: 7+1 bits)?",
                options: ["A) Que no puede manejar caracteres especiales.", "B) Que no puede enviar ficheros adjuntos.", "C) Que es más eficiente en la transmisión.", "D) Que siempre requiere cifrado."],
                correctAnswer: "B"
            },
            {
                question: "Si un mensaje pasa por varias MTAs, ¿qué cabeceras ayudan a la trazabilidad de ese camino?",
                options: ["A) From y To.", "B) Subject y Message-ID.", "C) Received y Return-Path.", "D) Content-Type y MIME-Version."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué es un identificador que se encuentra en el body para indicar cambio de contenido en MIME?",
                options: ["A) Content-Type", "B) Boundary", "C) Content-Transfer-Encoding", "D) MIME-Version."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es el objetivo principal de SPF?",
                options: ["A) Cifrar el contenido del correo.", "B) Autenticar al remitente para prevenir spoofing.", "C) Comprimir los ficheros adjuntos.", "D) Organizar los correos en carpetas."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué tipo de registro DNS es esencial para que una MTA emisora sepa dónde entregar los emails de un dominio?",
                options: ["A) Registro A", "B) Registro CNAME", "C) Registro MX", "D) Registro TXT"],
                correctAnswer: "C"
            },
            {
                question: "¿Cómo sabe el MUA que debe comunicarse con su MTA según el documento?",
                options: ["A) Por la consulta a un registro MX.", "B) Porque se configura previamente el servidor saliente y entrante.", "C) Por la información recibida del DNS.", "D) Automáticamente a través de DHCP."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué es el Mail User Agent (MUA)?",
                options: ["A) El servidor que transfiere correos.", "B) El programa que utilizan los usuarios para leer y enviar correos.", "C) El agente que entrega correos a los buzones.", "D) El servidor que accede a los buzones."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué tipo de codificación se usa para enviar credenciales Base64 en AUTH PLAIN?",
                options: ["A) Base64", "B) UTF-8", "C) ASCII", "D) Binary"],
                correctAnswer: "A"
            },
            {
                question: "¿Qué registro DNS permite especificar el puerto y el host de un servicio, como el de envío de correo MSA?",
                options: ["A) Registro A", "B) Registro CNAME", "C) Registro SRV", "D) Registro TXT"],
                correctAnswer: "C"
            },
            {
                question: "Si se utiliza el comando DELE en POP3, ¿cuándo se borra el mensaje del servidor?",
                options: ["A) Inmediatamente.", "B) Después de ejecutar RETR.", "C) Después de ejecutar QUIT.", "D) Nunca se borra."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el nombre del fichero que contiene la configuración del servidor DNS (resolver) en sistemas Linux?",
                options: ["A) /etc/hosts", "B) /etc/network/interfaces", "C) /etc/resolv.conf", "D) /etc/dns.conf"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué función principal tiene un Top-Level Domain Server en la resolución DNS?",
                options: ["A) Proporcionar la IP final del dominio.", "B) Redirigir al Root Server.", "C) Indicar qué servidor Authoritative gestiona el dominio.", "D) Cachear las IPs más frecuentes."],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el puerto de SMTP con seguridad?",
                options: ["A) 25", "B) 110", "C) 587", "D) 993"],
                correctAnswer: "C"
            },
            {
                question: "¿Qué significa IN A en un registro DNS?",
                options: ["A) Indica una entrada para un servicio.", "B) Indica una entrada de dirección IPv4.", "C) Indica una entrada para un alias.", "D) Indica una entrada para el servidor de correo."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué comando SMTP se usa para especificar el remitente del correo?",
                options: ["A) RCPT TO", "B) DATA", "C) HELO", "D) MAIL FROM"],
                correctAnswer: "D"
            },
            {
                question: "¿Qué característica tienen los \"flags\" en IMAP?",
                options: ["A) Son el tamaño de los mensajes.", "B) Indican el estado de los mensajes.", "C) Son las cabeceras del correo.", "D) Son los adjuntos del correo."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué se utiliza para agrupar por hilos de conversación?",
                options: ["A) Subject", "B) Message-ID", "C) Date", "D) From"],
                correctAnswer: "B"
            },
            {
                question: "Si el Mail Spool está orientado a la recepción, ¿qué implica esto?",
                options: ["A) Que se utiliza para almacenar temporalmente los correos salientes.", "B) Que es donde se guardan los correos antes de que el usuario los descargue o acceda a ellos.", "C) Que es el lugar donde se firman los correos.", "D) Que es el componente que filtra el spam."],
                correctAnswer: "B"
            },
            {
                question: "¿Cuál es el puerto por defecto para POP3?",
                options: ["A) 25", "B) 110", "C) 143", "D) 587"],
                correctAnswer: "B"
            },
            {
                question: "¿Qué es un Authoritative Server en la arquitectura DNS?",
                options: ["A) El servidor que responde a las consultas iniciales del resolver.", "B) El servidor que tiene la información definitiva de un dominio o zona.", "C) Un servidor que solo contiene registros MX.", "D) Un servidor que gestiona únicamente dominios de nivel superior."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué significa \\Deleted como un flag en IMAP?",
                options: ["A) Que el mensaje está corrupto.", "B) Que el mensaje ha sido enviado.", "C) Que el mensaje está marcado para borrado.", "D) Que el mensaje ha sido leído."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué comando SMTP finaliza la sesión?",
                options: ["A) HELO", "B) DATA", "C) QUIT", "D) RCPT TO"],
                correctAnswer: "C"
            },
            {
                question: "¿Cuál es el propósito del registro Return-Path?",
                options: ["A) Indicar la ruta que siguió el correo para llegar al destino.", "B) Indicar la dirección a la que se deben enviar los errores de entrega.", "C) Indicar la dirección de correo electrónico del remitente.", "D) Indicar la dirección de respuesta del correo."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué significa que IMAP esté \"Orientado a uso online\"?",
                options: ["A) Que los mensajes se descargan completamente al cliente.", "B) Que los mensajes se gestionan directamente en el servidor sin descargarlos por completo.", "C) Que solo se puede acceder al correo a través de un navegador web.", "D) Que solo se puede enviar correo, no recibir."],
                correctAnswer: "B"
            },
            {
                question: "¿Qué es EXPUNGE en IMAP?",
                options: ["A) Un comando para leer el contenido de un mensaje.", "B) Un comando para vaciar la bandeja de entrada.", "C) Un comando para borrar permanentemente los mensajes marcados con \\Deleted.", "D) Un comando para buscar mensajes."],
                correctAnswer: "C"
            },
            {
                question: "¿Qué se especifica con un registro CAA?",
                options: ["A) Qué IPs pueden enviar correos desde un dominio.", "B) Qué entidades pueden expedir certificados para un dominio.", "C) Qué servicios se ofrecen bajo un dominio.", "D) La dirección de correo electrónico del administrador del dominio."],
                correctAnswer: "B"
            }
        ];

        // Variables de estado del quiz
        let currentQuestionIndex = 0;
        let score = 0;
        // userAnswers almacena la letra de la opción seleccionada por el usuario para cada pregunta.
        const userAnswers = new Array(quizData.length).fill(null);
        // scoredQuestions rastrea si una pregunta ya ha sido calificada para evitar recalcular la puntuación.
        // Ahora, true significa correcta, false significa incorrecta, y null significa sin contestar.
        const scoredQuestions = new Array(quizData.length).fill(null);

        // Referencias a los elementos del DOM
        const quizContainer = document.getElementById('quizContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const restartBtn = document.getElementById('restartBtn');
        const restartInlineBtn = document.getElementById('restartInlineBtn');
        const finalScoreDiv = document.getElementById('finalScore');
        const progressBar = document.getElementById('progressBar');
        const finalScoreDisplay = finalScoreDiv.querySelector('.score-display');
        const correctCountSpan = document.getElementById('correctCount');
        const incorrectCountSpan = document.getElementById('incorrectCount');
        const unansweredCountSpan = document.getElementById('unansweredCount');

        /**
         * Carga el estado del quiz guardado en localStorage.
         * Si no existe, inicializa un nuevo estado.
         */
        function loadQuizState() {
            try {
                const savedState = JSON.parse(localStorage.getItem('quizState'));
                if (savedState) {
                    currentQuestionIndex = savedState.currentQuestionIndex;
                    score = savedState.score;
                    // Asegurarse de que los arrays tengan el tamaño correcto y copiar los valores guardados
                    userAnswers.fill(null); // Limpiar antes de copiar para evitar problemas de tamaño
                    userAnswers.splice(0, savedState.userAnswers.length, ...savedState.userAnswers);
                    scoredQuestions.fill(null); // Limpiar antes de copiar
                    scoredQuestions.splice(0, savedState.scoredQuestions.length, ...savedState.scoredQuestions);
                }
            } catch (e) {
                console.error("Error al cargar el estado del quiz:", e);
                // Si hay un error al cargar, el estado se mantendrá como inicializado (nuevo quiz)
            }
        }

        /**
         * Guarda el estado actual del quiz en localStorage.
         */
        function saveQuizState() {
            const quizState = {
                currentQuestionIndex: currentQuestionIndex,
                score: score,
                userAnswers: userAnswers,
                scoredQuestions: scoredQuestions
            };
            localStorage.setItem('quizState', JSON.stringify(quizState));
        }

        /**
         * Carga y muestra la pregunta actual en la interfaz.
         */
        function loadQuestion() {
            // Si el índice de la pregunta es mayor o igual al número total de preguntas,
            // significa que el quiz ha terminado y se deben mostrar los resultados.
            if (currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }

            const currentQuestion = quizData[currentQuestionIndex];
            quizContainer.innerHTML = `
                <div class="question-card">
                    <p class="question-text">${currentQuestionIndex + 1}. ${currentQuestion.question}</p>
                    <div id="optionsContainer">
                        ${currentQuestion.options.map((option, index) => `
                            <button class="option-button" data-option="${option}" data-option-letter="${option.charAt(0)}">${option}</button>
                        `).join('')}
                    </div>
                    <div class="solution hidden">
                        <strong>Solución:</strong> <span class="solution-text"></span>
                    </div>
                </div>
            `;

            const optionsContainer = document.getElementById('optionsContainer');
            // Añade el evento de clic a los botones de opción.
            optionsContainer.addEventListener('click', handleOptionClick);

            // Resalta la respuesta del usuario si ya ha respondido a esta pregunta.
            const savedAnswerLetter = userAnswers[currentQuestionIndex];
            if (savedAnswerLetter !== null) {
                const selectedButton = optionsContainer.querySelector(`[data-option-letter="${savedAnswerLetter}"]`);
                if (selectedButton) {
                    // Llama a checkAnswer para aplicar los estilos sin recalcular la puntuación.
                    checkAnswer(selectedButton, true); 
                }
            }
            
            // Actualiza el estado de los botones de navegación y la barra de progreso.
            updateNavButtons();
            updateProgressBar();
        }
        
        /**
         * Maneja el evento de clic en una opción de respuesta.
         * @param {Event} event - El evento de clic.
         */
        function handleOptionClick(event) {
            const clickedButton = event.target.closest('.option-button');
            // Asegúrate de que se hizo clic en un botón de opción y que no esté deshabilitado.
            if (clickedButton && !clickedButton.classList.contains('disabled')) {
                const selectedOptionLetter = clickedButton.dataset.optionLetter;
                
                // Almacena la respuesta del usuario.
                userAnswers[currentQuestionIndex] = selectedOptionLetter;
                saveQuizState(); // Guarda el estado después de cada respuesta.
                
                // Verifica la respuesta y actualiza la UI y la puntuación.
                checkAnswer(clickedButton, false); // 'false' indica que es una nueva respuesta, no una recarga.
            }
        }

        /**
         * Verifica la respuesta seleccionada por el usuario y actualiza la UI y la puntuación.
         * @param {HTMLElement} selectedButton - El botón de opción seleccionado por el usuario.
         * @param {boolean} isReload - Indica si la función es llamada desde una recarga de pregunta (true)
         * o por una nueva selección del usuario (false).
         */
        function checkAnswer(selectedButton, isReload) {
            const currentQuestion = quizData[currentQuestionIndex];
            const options = document.querySelectorAll('.option-button');

            // Deshabilita todos los botones de opción para esta pregunta una vez respondida.
            options.forEach(btn => {
                btn.classList.add('disabled');
                // Remueve el event listener para evitar múltiples llamadas si se navega y vuelve.
                btn.removeEventListener('click', handleOptionClick);
            });
            
            // Solo actualiza la puntuación y el estado de scoredQuestions si no es una recarga
            // y la pregunta aún no ha sido calificada (es decir, scoredQuestions[currentQuestionIndex] es null).
            if (!isReload && scoredQuestions[currentQuestionIndex] === null) { 
                if (selectedButton.dataset.optionLetter === currentQuestion.correctAnswer) {
                    score++; // Incrementa la puntuación si es correcta.
                    selectedButton.classList.add('correct-answer');
                    updateQuestionCard(true); // Actualiza la tarjeta de pregunta a correcta.
                    scoredQuestions[currentQuestionIndex] = true; // Marca como CORRECTAMENTE puntuado
                } else {
                    selectedButton.classList.add('incorrect-answer');
                    // Muestra la respuesta correcta.
                    const correctButton = document.querySelector(`[data-option-letter="${currentQuestion.correctAnswer}"]`);
                    if (correctButton) {
                        correctButton.classList.add('correct-answer');
                    }
                    updateQuestionCard(false); // Actualiza la tarjeta de pregunta a incorrecta.
                    scoredQuestions[currentQuestionIndex] = false; // Marca como INCORRECTAMENTE puntuado
                }
                saveQuizState(); // Guarda el estado actualizado de la puntuación y scoredQuestions.
            } else if (isReload) {
                // Si es una recarga, solo aplica los estilos basados en la respuesta guardada
                // y el estado de scoredQuestions, sin modificar la puntuación.
                const userChoice = userAnswers[currentQuestionIndex];
                
                if (userChoice === currentQuestion.correctAnswer) {
                    selectedButton.classList.add('correct-answer');
                    updateQuestionCard(true);
                } else {
                    selectedButton.classList.add('incorrect-answer');
                    const correctButton = document.querySelector(`[data-option-letter="${currentQuestion.correctAnswer}"]`);
                    if (correctButton) {
                        correctButton.classList.add('correct-answer');
                    }
                    updateQuestionCard(false);
                }
            }
            // Si la pregunta ya fue calificada y no es una recarga, no se hace nada.
        }

        /**
         * Actualiza el estilo de la tarjeta de pregunta y añade feedback visual.
         * @param {boolean} isCorrect - Indica si la respuesta es correcta.
         */
        function updateQuestionCard(isCorrect) {
            const questionCard = document.querySelector('.question-card');
            // Limpia cualquier feedback anterior antes de añadir uno nuevo
            const existingFeedback = questionCard.querySelector('.feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }
            // Elimina las clases de estado anteriores para asegurar que solo se aplique la correcta
            questionCard.classList.remove('correct', 'incorrect');

            const feedbackMessage = document.createElement('p');
            feedbackMessage.classList.add('feedback');

            if (isCorrect) {
                questionCard.classList.add('correct');
                feedbackMessage.textContent = '¡Correcto!';
                feedbackMessage.classList.add('correct');
            } else {
                questionCard.classList.add('incorrect');
                feedbackMessage.textContent = 'Incorrecto. La respuesta correcta es la marcada en verde.';
                feedbackMessage.classList.add('incorrect');
            }
            questionCard.appendChild(feedbackMessage);
        }

        /**
         * Muestra los resultados finales del quiz.
         */
        function showResults() {
            quizContainer.classList.add('hidden');
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            restartInlineBtn.classList.add('hidden');
            progressBar.parentElement.classList.add('hidden'); // Oculta el contenedor de la barra de progreso
            finalScoreDiv.classList.remove('hidden');

            // Calcula y muestra las estadísticas finales
            const correctAnswers = scoredQuestions.filter(isCorrect => isCorrect === true).length; // Filtra por 'true' explícito
            const incorrectAnswers = scoredQuestions.filter(isCorrect => isCorrect === false).length; // Filtra por 'false' explícito
            const unansweredQuestions = userAnswers.filter(answer => answer === null).length;

            finalScoreDisplay.textContent = `Tu puntuación final es ${correctAnswers} de ${quizData.length}`;
            correctCountSpan.textContent = correctAnswers;
            incorrectCountSpan.textContent = incorrectAnswers;
            unansweredCountSpan.textContent = unansweredQuestions;
        }

        /**
         * Actualiza el estado de los botones de navegación (Anterior/Siguiente).
         */
        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.textContent = currentQuestionIndex === quizData.length - 1 ? 'Finalizar' : 'Siguiente';
        }

        /**
         * Actualiza la barra de progreso visualmente.
         */
        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        /**
         * Reinicia el quiz a su estado inicial.
         */
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            userAnswers.fill(null);
            scoredQuestions.fill(null); // Ahora se inicializa con null
            localStorage.clear(); // Limpia todo el estado guardado en localStorage
            
            // Muestra los elementos del quiz y oculta la pantalla de resultados finales
            quizContainer.classList.remove('hidden');
            prevBtn.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            restartInlineBtn.classList.remove('hidden');
            progressBar.parentElement.classList.remove('hidden');
            finalScoreDiv.classList.add('hidden');
            
            loadQuestion(); // Carga la primera pregunta para iniciar el quiz
        }

        // Event listeners para los botones de navegación y reinicio
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                saveQuizState(); // Guarda el estado antes de cambiar de pregunta
                loadQuestion();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                saveQuizState(); // Guarda el estado antes de cambiar de pregunta
                loadQuestion();
            } else {
                // Si es la última pregunta y se hace clic en "Finalizar"
                showResults();
            }
        });

        restartBtn.addEventListener('click', restartQuiz); // Botón de reinicio en la pantalla de resultados
        restartInlineBtn.addEventListener('click', restartQuiz); // Botón de reinicio en línea

        // Carga inicial del quiz cuando la ventana ha terminado de cargar
        window.onload = function() {
            loadQuizState(); // Intenta cargar un estado guardado
            loadQuestion(); // Carga la pregunta actual (o la primera si no hay estado guardado)
        };
    </script>
</body>
</html>

